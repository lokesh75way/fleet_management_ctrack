"use strict";(self.webpackChunkFLEET=self.webpackChunkFLEET||[]).push([[5775],{45775:(e,a,s)=>{s.r(a),s.d(a,{default:()=>H});var t=s(65043),n=s(35475),l=s(24858),r=s(18403),i=s(74117),c=s(60446),o=s.n(c),d=s(63248),m=s(28261),u=s(99723),h=s(47097),x=s(18733),j=s(94692),p=s(42457),v=s(70228),g=s(40399),b=s(19172),f=s(33723),N=s(45350),y=s(5761),k=s(272),C=s(6720),T=s(60184),D=s(95977),P=s(70579);const w=e=>{let{tableData:a,onConfirmDelete:s,editDrawerOpen:t,currentPage:n,itemsPerPage:l}=e;const{can:r}=(0,N.A)(),i=r("technician/tasks","modify"),c=r("technician/tasks","delete"),o=(n-1)*l+1;return(0,P.jsx)(P.Fragment,{children:a.map(((e,a)=>{var n,l,r,d;return(0,P.jsxs)("tr",{children:[(0,P.jsx)("td",{children:(0,P.jsx)("span",{children:o+a})}),(0,P.jsx)("td",{children:(0,P.jsx)("div",{className:"products",children:(0,P.jsx)("div",{children:(0,P.jsx)("h6",{children:e.taskName})})})}),(0,P.jsx)("td",{children:(0,P.jsx)("span",{children:e.taskCategory})}),(0,P.jsx)("td",{children:(0,P.jsx)("span",{children:"".concat(null!==(n=null===(l=e.technician)||void 0===l?void 0:l.firstName)&&void 0!==n?n:""," ").concat(null!==(r=null===(d=e.technician)||void 0===d?void 0:d.lastName)&&void 0!==r?r:"")})}),(0,P.jsx)("td",{children:(0,P.jsx)("span",{children:e.serviceLocation})}),(0,P.jsx)("td",{children:(0,P.jsx)("span",{className:"text-primary",children:e.reportingTime})}),(i||c)&&(0,P.jsx)("td",{children:(0,P.jsxs)("span",{className:"d-flex justify-content-center",children:[i&&(0,P.jsx)("span",{className:"cursor-pointer",onClick:()=>t(null===e||void 0===e?void 0:e._id),children:(0,P.jsx)(T.uO9,{style:{color:"green",fontSize:"1.2rem"}})}),c&&(0,P.jsx)(D.A,{className:"cursor-pointer ",onConfirmDelete:s,id:e._id,children:(0,P.jsx)(C.b6i,{style:{color:"red",fontSize:"1.2rem"}})})]})})]},a)}))})};var A=s(28086),S=s(31899),E=s.n(S),I=(s(9531),s(42297)),F=(s(43),s(87460)),_=s(28334),R=s(74805),L=s(75714),V=s(42880);const q=e=>{let{onChange:a,value:s,groupId:n,branchId:l,companyId:r,customStyles:i,name:c,ref:o,isDisabled:d,defaultValue:u}=e;const[h,x]=(0,t.useState)(s),{page:p,setPage:v}=(0,j.A)(),{can:g}=(0,N.A)(),{data:b,fetchNextPage:f,hasNextPage:k,isFetching:C,isFetchingNextPage:T}=(0,L.q)({queryKey:["technicians",n,l,r],queryFn:e=>{let{pageParam:a}=e;return v(a),(0,y.LD)(a,10,{groupId:n,branchId:l,companyId:r})},initialPageParam:1,getNextPageParam:(e,a)=>{var s;return null!==(s=e.data)&&void 0!==s&&s.length?p+1:null},enabled:g("technician","view"),staleTime:1/0}),{refetch:D}=(0,m.I)({queryKey:["technician",u],queryFn:()=>(0,y.Lb)(u),enabled:!1,staleTime:1/0}),w=(0,t.useMemo)((()=>{let e=[];return null===b||void 0===b||b.pages.forEach((a=>{a.data.forEach((a=>{var s,t;e.push({label:"".concat(null!==(s=null===a||void 0===a?void 0:a.firstName)&&void 0!==s?s:""," ").concat(null!==(t=null===a||void 0===a?void 0:a.lastName)&&void 0!==t?t:""),value:null===a||void 0===a?void 0:a._id})}))})),e}),[b]);(0,t.useEffect)((()=>((null===s||void 0===s?void 0:s.value)!=(null===h||void 0===h?void 0:h.value)&&x(s),()=>{})),[s]),(0,t.useEffect)((()=>{(async()=>{if(s||u)if(u){const s=w.find((e=>e.value===u));if(s)return x(s),void a(s);try{const{data:s}=await D();if(s){var e,t;const n={label:"".concat(null!==(e=null===s||void 0===s?void 0:s.firstName)&&void 0!==e?e:""," ").concat(null!==(t=null===s||void 0===s?void 0:s.lastName)&&void 0!==t?t:""),value:s._id};x(n),a(n)}}catch(n){console.error("Error fetching technician details:",n)}}else x(s)})()}),[u,w,C]);return(0,P.jsx)(I.Ay,{options:w,value:h,onChange:a,styles:i,name:c,ref:o,isDisabled:d||!g("technician","view"),onMenuScrollToBottom:async e=>{e.target.scrollHeight-e.target.scrollTop===e.target.clientHeight&&!C&&k&&!T&&f()},menuShouldScrollIntoView:!1,isLoading:C,components:{LoadingIndicator:V.A}})},M={control:e=>({...e,padding:".25rem 0 "})},Y=(0,t.forwardRef)(((e,a)=>{let{Title:s,handleSubmit:n,editData:r,setEditData:c,control:o,setValue:d,getValues:m,register:u,errors:h,clearErrors:x,onSubmit:j,reset:p,isLoading:v}=e;const[g,b]=(0,t.useState)(!1),{t:f}=(0,i.Bd)();return(0,t.useImperativeHandle)(a,(()=>({showModal(){b(!0)},closeModal(){p(),x(),b(!1)}}))),(0,t.useEffect)((()=>{p({}),x(),g&&r?(p({...r,technician:r.technician._id}),d("description",r.description)):c()}),[g]),(0,P.jsx)(P.Fragment,{children:(0,P.jsxs)(A.A,{show:g,onHide:b,className:"offcanvas-end customeoff",placement:"end",children:[(0,P.jsxs)("div",{className:"offcanvas-header",children:[(0,P.jsx)("h5",{className:"modal-title",id:"#gridSystemModal",children:s}),(0,P.jsx)("button",{type:"button",className:"btn-close",onClick:()=>b(!1),children:(0,P.jsx)("i",{className:"fa-solid fa-xmark"})})]}),(0,P.jsx)("div",{className:"offcanvas-body",children:(0,P.jsx)("div",{className:"container-fluid",children:(0,P.jsx)(l.Op,{children:(0,P.jsxs)("form",{noValidate:!0,onSubmit:n(j),children:[(0,P.jsxs)("div",{className:"row",children:[(0,P.jsxs)("div",{className:"col-xl-6 mb-3",children:[(0,P.jsxs)("label",{className:"form-label",children:[f("technician")," ",(0,P.jsx)("span",{className:"text-danger",children:"*"})]}),(0,P.jsx)(l.xI,{name:"technician",control:o,rules:{required:!0},render:e=>{let{field:{onChange:a,value:s,name:t,ref:n}}=e;return(0,P.jsx)(q,{onChange:e=>{d("technician",e.value)},defaultValue:s,value:s,customStyles:M,ref:n,name:t})}}),(0,P.jsx)(_.A,{errorName:h.technician})]}),(0,P.jsxs)("div",{className:"col-xl-6 mb-3",children:[(0,P.jsxs)("label",{className:"form-label",children:[f("taskCategory"),(0,P.jsx)("span",{className:"text-danger",children:"*"})]}),(0,P.jsx)(l.xI,{name:"c",control:o,rules:{required:!0},render:e=>{let{field:{onChange:a,value:s,name:t,ref:n}}=e;return(0,P.jsx)(I.Ay,{onChange:e=>{d("taskCategory",e.value)},options:F.qf,ref:n,name:t,styles:M,value:s,defaultValue:{value:m("taskCategory")?m("taskCategory"):F.qf[0].value,label:m("taskCategory")?m("taskCategory"):F.qf[0].label}})}}),(0,P.jsx)(_.A,{errorName:h.taskCategory})]}),(0,P.jsxs)("div",{className:"col-xl-6 mb-3",children:[(0,P.jsxs)("label",{htmlFor:"exampleFormControlInput2",className:"form-label",children:[f("taskName")," ",(0,P.jsx)("span",{className:"text-danger",children:"*"})]}),(0,P.jsx)(R.A,{type:"text",register:u,name:"taskName",label:"Task Name",placeholder:""}),(0,P.jsx)(_.A,{errorName:h.taskName})]}),(0,P.jsxs)("div",{className:"col-xl-6 mb-3",children:[(0,P.jsxs)("label",{className:"form-label",children:[f("taskPriority")," ",(0,P.jsx)("span",{className:"text-danger",children:"*"})]}),(0,P.jsx)(l.xI,{name:"taskPriority",control:o,rules:{required:!0},render:e=>{let{field:{onChange:a,value:s,name:t,ref:n}}=e;return(0,P.jsx)(I.Ay,{onChange:e=>{d("taskPriority",e.value)},options:F.YR,ref:n,name:t,styles:M,defaultValue:{value:m("taskPriority")?m("taskPriority"):F.YR[0].value,label:m("taskPriority")?m("taskPriority"):F.YR[0].label}})}}),(0,P.jsx)(_.A,{errorName:h.taskPriority})]}),(0,P.jsxs)("div",{className:"col-xl-6 mb-3",children:[(0,P.jsx)("label",{htmlFor:"exampleFormControlInput3",className:"form-label",children:f("contactPersonNumber")}),(0,P.jsx)(R.A,{type:"number",register:u,name:"contactPersonNumber",label:"Contact Person Number",placeholder:""}),(0,P.jsx)(_.A,{errorName:h.contactPersonNumber})]}),(0,P.jsxs)("div",{className:"col-xl-6 mb-3",children:[(0,P.jsxs)("label",{className:"form-label",children:[f("serviceLocation"),(0,P.jsx)("span",{className:"text-danger",children:"*"})]}),(0,P.jsx)(R.A,{type:"text",name:"serviceLocation",register:u,label:"Service Location",placeholder:""}),(0,P.jsx)(_.A,{errorName:h.serviceLocation})]}),(0,P.jsxs)("div",{className:"col-xl-6 mb-3 d-flex flex-column",children:[(0,P.jsxs)("label",{className:"form-label",children:[f("plannedReportingDate")," ",(0,P.jsx)("span",{className:"text-danger",children:"*"})]}),(0,P.jsx)(l.xI,{name:"plannedReportingDate",control:o,render:e=>{let{value:a,name:s}=e;return(0,P.jsx)(E(),{selected:m("plannedReportingDate")?new Date(m("plannedReportingDate")):new Date,className:"form-control customDateHeight",onChange:e=>d("plannedReportingDate",e),minDate:new Date})}}),(0,P.jsx)(_.A,{errorName:h.plannedReportingDate})]}),(0,P.jsxs)("div",{className:"col-xl-6 mb-3 ",children:[(0,P.jsxs)("label",{className:"form-label",children:[f("reportingTime"),(0,P.jsx)("span",{className:"text-danger",children:"*"})]}),(0,P.jsx)(R.A,{type:"time",register:u,name:"reportingTime",label:"Reporting Time",placeholder:""}),(0,P.jsx)(_.A,{errorName:h.reportingTime})]}),(0,P.jsxs)("div",{className:"col-xl-6 mb-3",children:[(0,P.jsx)("label",{className:"form-label",children:f("description")}),(0,P.jsx)("div",{className:"mb-3 ",children:(0,P.jsx)(l.xI,{name:"description",control:o,defaultValue:"",render:e=>{let{field:a}=e;return(0,P.jsx)("textarea",{className:"form-txtarea form-control",register:u("description"),name:"description",label:"Description",rows:"8",id:"comment",...a})}})})]})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("button",{type:"submit",onClick:()=>{n(j)},className:"btn btn-primary me-1 m-1",disabled:v,children:f("submit")}),(0,P.jsx)("button",{type:"button",disabled:v,onClick:()=>b(!1),className:"btn btn-danger light ms-1 m-1",children:f("cancel")})]})]})})})})]})})})),H=()=>{const{t:e}=(0,i.Bd)(),{isRtl:a}=(0,t.useContext)(f.D),[s,c]=(0,t.useState)(),{can:C}=(0,N.A)(),{page:T,goToPage:D,setCount:A,totalCount:S}=(0,j.A)(),E=(0,d.jE)(),{data:I,isLoading:F,isFetching:_}=(0,m.I)({queryKey:["tasks",T],queryFn:()=>(0,y.x1)(T),placeholderData:u.rX,staleTime:1/0}),R=e=>(0,p.U)((0,k.SU)(e)),{mutate:L}=(0,h.n)({onError:R,onSuccess:()=>{E.invalidateQueries("tasks")},mutationFn:y.vq}),{mutate:V,isPending:q}=(0,h.n)({mutationFn:y.UT,onSuccess:()=>{var e;(0,p.V)("New Task Created"),E.invalidateQueries(["tasks"]),null===(e=W.current)||void 0===e||e.closeModal()},onError:R}),{mutate:M,isPending:H}=(0,h.n)({mutationFn:e=>{let{data:a,id:s}=e;return(0,y.lC)(a,s)},onSuccess:()=>{var e;(0,p.V)("Task Updated Successfully"),E.invalidateQueries(["tasks"]),null===(e=W.current)||void 0===e||e.closeModal()},onError:R});(0,t.useEffect)((()=>{I&&A(I.totalCount)}),[I]);const O=[e("id"),e("taskName"),e("taskCategory"),e("technicianName"),e("serviceLocation"),e("reportingTime")];(C("technician/tasks","modify")||C("technician/tasks","delete"))&&O.push(e("action"));const{register:U,formState:{errors:B},setValue:K,getValues:Q,control:z,handleSubmit:X,clearErrors:G,reset:J}=(0,l.mN)({resolver:(0,r.t)(v.l2)}),W=(0,t.useRef)();return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(g.A,{mainTitle:e("technicianTask"),pageTitle:e("technicianTask"),parentTitle:e("technician")}),(0,P.jsx)("div",{className:"container-fluid",children:(0,P.jsx)("div",{className:"row",children:(0,P.jsx)("div",{className:"col-xl-12",children:(0,P.jsx)("div",{className:"card",children:(0,P.jsx)("div",{className:"card-body p-0",children:(0,P.jsxs)("div",{className:"table-responsive active-projects style-1 ItemsCheckboxSec shorting",children:[(0,P.jsxs)("div",{className:"tbl-caption d-flex justify-content-between text-wrap align-items-center",children:[(0,P.jsx)("h4",{className:"heading mb-0",children:e("technicianTask")}),(0,P.jsx)("div",{children:C("technician/tasks","add")&&(0,P.jsxs)(n.N_,{to:"#",className:"btn btn-primary btn-sm ms-1","data-bs-toggle":"offcanvas",onClick:()=>{G(),J(),W.current.showModal()},children:["+ ",e("addTechnicianTask")]})})]}),(0,P.jsxs)("div",{id:"employee-tbl_wrapper",className:"dataTables_wrapper no-footer",children:[(0,P.jsx)("div",{className:"table-responsive",children:F||_?(0,P.jsx)(x.A,{}):(0,P.jsxs)("table",{id:"empoloyees-tblwrapper",className:"table ItemsCheckboxSec dataTable no-footer mb-0",children:[(0,P.jsx)("thead",{children:(0,P.jsx)("tr",{children:O.map((e=>(0,P.jsx)("th",{children:e},e)))})}),(0,P.jsx)("tbody",{children:(0,P.jsx)(w,{tableData:I.data||[],onConfirmDelete:L,editDrawerOpen:e=>{var a,s;const t=null===I||void 0===I||null===(a=I.data)||void 0===a?void 0:a.find((a=>a._id===e));c(t),null===(s=W.current)||void 0===s||s.showModal()},currentPage:T,itemsPerPage:10})})]})}),(0,P.jsxs)("div",{className:"d-sm-flex text-center justify-content-between align-items-center",children:[(0,P.jsxs)("div",{className:"dataTables_info",children:[e("showing")," ",10*(T-1)+1," ",e("to")," ",Math.min(10*T,S)," ",e("of")," ",S," ",e("entries")]}),(0,P.jsx)("div",{className:"dataTables_paginate paging_simple_numbers",id:"example2_paginate",children:(0,P.jsx)(b.A,{totalCount:S,itemsPerPage:10,handlePageClick:e=>{let{selected:a}=e;D(a+1)},isRtl:a})})]})]})]})})})})})}),(0,P.jsx)(Y,{ref:W,editData:s,control:z,setValue:K,getValues:Q,onSubmit:async e=>{if(e.plannedReportingDate){const a=o()(e.plannedReportingDate).format("YYYY-MM-DD");e.plannedReportingDate=a}e._id&&0!==e._id?M({data:e,id:e._id}):V(e)},register:U,errors:B,setEditData:c,handleSubmit:X,clearErrors:G,reset:J,Title:s&&0!==s._id?e("editTask"):e("addTask"),isLoading:q||H})]})}}}]);
//# sourceMappingURL=5775.d275e745.chunk.js.map