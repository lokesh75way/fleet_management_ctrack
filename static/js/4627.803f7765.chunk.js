"use strict";(self.webpackChunkFLEET=self.webpackChunkFLEET||[]).push([[4627],{5409:(e,a,t)=>{t.r(a),t.d(a,{default:()=>O});var s=t(65043),n=t(60184),l=t(6720),i=t(60397),c=t(74117),r=(t(43),t(28261)),o=t(83998),d=t(44816),h=t(86856),u=t(50423),m=t(47522),p=(t(19980),t(79904)),v=t.n(p),x=t(14282),g=t(70579);const f=e=>{const[a,t]=(0,s.useState)([]),[n,l]=(0,s.useState)([]),[i,c]=(0,s.useState)([]);(0,s.useEffect)((()=>{const a=null===e||void 0===e?void 0:e.companyVehicle.map((e=>{var a;const t=null===e||void 0===e||null===(a=e.vehicles)||void 0===a?void 0:a.map((e=>({label:null===e||void 0===e?void 0:e.vehicleName,value:null===e||void 0===e?void 0:e._id})));return{value:null===e||void 0===e?void 0:e._id,label:null===e||void 0===e?void 0:e.companyName,children:t}}));c([...a])}),[e.companyVehicle]),(0,s.useEffect)((()=>{let e=[];null===i||void 0===i||i.map((a=>{var t;return null===(t=a.children)||void 0===t?void 0:t.map((a=>e.push(a.value)))}));r(e)}),[i]);const r=a=>{t(a),e.setVehicleIds(a)};return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"checkboxTree",children:(0,g.jsx)(v(),{nodes:i,checked:a,expanded:n,onCheck:r,onExpand:e=>{l(e)},showNodeIcon:!1,icons:{expandOpen:(0,g.jsx)("i",{class:"fa-solid fa-minus"}),expandClose:(0,g.jsx)("i",{class:"fa-solid fa-plus"}),uncheck:(0,g.jsx)("i",{class:"fa-regular fa-square",style:{fontSize:"16px"}}),check:(0,g.jsx)("i",{class:"fa-solid fa-square-check",style:{fontSize:"16px"}}),halfCheck:(0,g.jsx)("i",{class:"fa-regular fa-square-minus",style:{fontSize:"16px"}})}})}),(0,g.jsx)("div",{className:"text-center  pt-2 ",children:(0,g.jsx)(x.A,{className:" mb-5",variant:"primary btn-md ",type:"submit",onClick:()=>{e.handleToggleCardPositionHandler()},children:"Save Selection"})})]})};var j=t(272);const S=e=>{let{geoFences:a,handleToggleCardPositionHandler:t}=e;const[n,l]=(0,s.useState)([]),[i,c]=(0,s.useState)([]),[r,o]=(0,s.useState)([]);(0,s.useEffect)((()=>{const e=Object.entries(a).map((e=>{let[a,t]=e;return{value:a,label:a,children:t.map((e=>({label:e.name,value:e.id})))}}));o(e)}),[a]);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"checkboxTree",children:(0,g.jsx)(v(),{nodes:r,checked:n,expanded:i,onCheck:e=>{l(e)},onExpand:e=>{c(e)},showNodeIcon:!1,icons:{expandOpen:(0,g.jsx)("i",{className:"fa-solid fa-minus"}),expandClose:(0,g.jsx)("i",{className:"fa-solid fa-plus"}),uncheck:(0,g.jsx)("i",{className:"fa-regular fa-square",style:{fontSize:"16px"}}),check:(0,g.jsx)("i",{className:"fa-solid fa-square-check",style:{fontSize:"16px"}}),halfCheck:(0,g.jsx)("i",{className:"fa-regular fa-square-minus",style:{fontSize:"16px"}})}})}),(0,g.jsx)("div",{className:"text-center  pt-2 ",children:(0,g.jsx)(x.A,{className:" mb-5",variant:"primary btn-md ",type:"submit",onClick:()=>{n.map((e=>JSON.parse(e)));t()},children:"Save Selection"})})]})},N=e=>{const[a,t]=(0,s.useState)([]),[n,l]=(0,s.useState)([]),[i,c]=(0,s.useState)([]);(0,s.useEffect)((()=>{const a=Object.entries(e.drivers).map((e=>{const a=e[1].map((e=>({label:e.firstName,value:e.id})));return{value:e[0],label:e[0],children:a}}));c([...a])}),[e.drivers]);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"checkboxTree",children:(0,g.jsx)(v(),{nodes:i,checked:a,expanded:n,onCheck:e=>{t(e)},onExpand:e=>{l(e)},showNodeIcon:!1,icons:{expandOpen:(0,g.jsx)("i",{class:"fa-solid fa-minus"}),expandClose:(0,g.jsx)("i",{class:"fa-solid fa-plus"}),uncheck:(0,g.jsx)("i",{class:"fa-regular fa-square",style:{fontSize:"16px"}}),check:(0,g.jsx)("i",{class:"fa-solid fa-square-check",style:{fontSize:"16px"}}),halfCheck:(0,g.jsx)("i",{class:"fa-regular fa-square-minus",style:{fontSize:"16px"}})}})}),(0,g.jsx)("div",{className:"text-center  pt-2 ",children:(0,g.jsx)(x.A,{className:" mb-5",variant:"primary btn-md ",type:"submit",onClick:()=>{const t=a.map((e=>JSON.parse(e)));console.log(t,"selctedObject"),e.handleToggleCardPositionHandler()},children:"Save Selection"})})]})};var k=t(42457),C=t(77154);const y=e=>{var a,t;const{setVehicleStatus:n,vehicleCounts:l}=e,{running:i,idle:c,stopped:r,inactive:o,nodata:d,total:h}=l,[u,p]=(0,s.useState)("All"),[v,x]=(0,s.useState)([]),[S,N]=(0,s.useState)([]),y=async e=>{try{var a;const t=await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const{data:a}=await C.A.get("/vehicles/list?search=".concat(e));return{data:a.data}}(e);return void await N(null!==(a=null===t||void 0===t?void 0:t.data)&&void 0!==a?a:[])}catch(t){(0,k.U)("Some Error occured")}};(0,s.useEffect)((()=>{y()}),[u]);const b=JSON.parse(null===(a=localStorage)||void 0===a?void 0:a.getItem("userJsonData"))?JSON.parse(null===(t=localStorage)||void 0===t?void 0:t.getItem("userJsonData")).filter((e=>"vehicle"===e.designation)).map((e=>({id:e.id,name:e.vehicleName}))):[];return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"vehicle_tracking-object",children:[(0,g.jsxs)("span",{className:"light fs-9 running ".concat("Running"===u&&"vehicle_tracking-active"),onClick:()=>{p("Running"),n("RUNNING")},children:[(0,g.jsx)("p",{children:i}),(0,g.jsx)("span",{children:"Running"})]}),(0,g.jsxs)("span",{pill:!0,className:"light fs-9 idle ".concat("Idle"===u&&"vehicle_tracking-active"),onClick:()=>{p("Idle"),n("IDLE")},children:[(0,g.jsx)("p",{children:c}),(0,g.jsx)("span",{children:"Idle"})]}),(0,g.jsxs)("span",{pill:!0,className:"light stopped fs-9 ".concat("Stopped"===u&&"vehicle_tracking-active"),onClick:()=>{p("Stopped"),n("STOP")},children:[(0,g.jsx)("p",{children:r}),(0,g.jsx)("span",{children:"Stopped"})]}),(0,g.jsxs)("span",{pill:!0,className:"light fs-9 inActive ".concat("Inactive"===u&&"vehicle_tracking-active"),onClick:()=>{p("Inactive"),n("INACTIVE")},children:[(0,g.jsx)("p",{children:o}),(0,g.jsx)("span",{children:"InActive"})]}),(0,g.jsxs)("span",{pill:!0,className:"light fs-9 noData ".concat("NoData"===u&&"vehicle_tracking-active"),onClick:()=>{p("NoData"),n("NODATA")},children:[(0,g.jsx)("p",{children:d}),(0,g.jsx)("span",{children:"NoData"})]}),(0,g.jsxs)("span",{className:"light fs-9 total ".concat("All"===u&&"vehicle_tracking-active"),onClick:()=>{p("All"),n("")},children:[(0,g.jsx)("p",{children:h}),(0,g.jsx)("span",{children:"Total"})]})]}),(0,g.jsx)("div",{className:"d-flex mt-4 mb-4",children:(0,g.jsx)(m.ReactSearchAutocomplete,{items:b,className:"w-100",styling:{height:"30px",marginRight:"10px",fontSize:"12px",color:"#4A4646"},onSearch:e=>{if(""===e){const e=(0,j.kw)(u);x(e)}},onSelect:e=>{const a=(0,j.kw)(u),t=Object.entries(a).filter((a=>a[1].filter((a=>a.id==e.id)).length>0)).reduce(((a,t)=>{let[s,n]=t;return n.map((t=>{t.vehicleName===e.name&&(a[s]=[t])})),a}),{});x(t)}})}),(0,g.jsx)(f,{companyVehicle:null!==S&&void 0!==S?S:[],setVehicleIds:e.setVehicleIds,vehicles:v,handleToggleCardPositionHandler:e.handleToggleCardPosition})]})},b=e=>{const[a,t]=(0,s.useState)("All"),[n,l]=(0,s.useState)([]),[i,c]=(0,s.useState)([]),[r,o]=(0,s.useState)([]),[d,h]=(0,s.useState)(!1),[u,p]=(0,s.useState)(!1),v=JSON.parse(localStorage.getItem("userJsonData"))?JSON.parse(localStorage.getItem("userJsonData")):[],[x,f]=(0,s.useState)([]),[j,S]=(0,s.useState)(v.filter((e=>"company"===e.role))),[k,C]=(0,s.useState)(v.filter((e=>"Driver"===e.designation))),y=k.filter((e=>"Allocated"===e.activityStatus)),b=k.filter((e=>"Not Allocated"===e.activityStatus));(0,s.useEffect)((()=>{const e=j.reduce(((e,a)=>{const t=v.filter((e=>"Driver"===e.designation&&e.parentCompany===a.userName));return t.length>0&&(e[a.userName]=t),e}),{});f(e)}),[j]),(0,s.useEffect)((()=>{const e=j.reduce(((e,t)=>{const s=v.filter((e=>"Driver"===e.designation&&e.parentCompany===t.userName&&("All"==a||e.activityStatus===a)));return s.length>0&&(e[t.userName]=s),e}),{});f(e)}),[a]);const A=k.length,T=v.filter((e=>"Driver"===e.designation)).map((e=>({id:e.id,name:e.firstName+" "+e.lastName})));return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"px-2 vehicle_tracking-object",children:[(0,g.jsxs)("span",{bg:"",pill:!0,className:"light fs-9  running ".concat("Allocated"===a?"vehicle_tracking-active":u&&"pe-none"),onClick:()=>t("Allocated"),children:[(0,g.jsx)("p",{children:y.length}),(0,g.jsx)("span",{children:"Allocated"})]}),(0,g.jsxs)("span",{bg:"",pill:!0,className:"light fs-9 idle ".concat("Not Allocated"===a?"vehicle_tracking-active":u&&"pe-none"),onClick:()=>t("Not Allocated"),children:[(0,g.jsx)("p",{children:b.length}),(0,g.jsx)("span",{children:"Not Allocated"})]}),(0,g.jsxs)("span",{bg:"",pill:!0,className:"light fs-9 total ".concat("Total"===a?"vehicle_tracking-active":u&&"pe-none"),onClick:()=>t("All"),children:[(0,g.jsx)("p",{children:A}),(0,g.jsx)("span",{children:"Total"})]})]}),(0,g.jsx)("div",{className:"d-flex mt-4 mb-4",children:(0,g.jsx)(m.ReactSearchAutocomplete,{items:T,className:"w-100",styling:{height:"30px",marginRight:"10px",fontSize:"12px",color:"#red"},onSearch:(e,a)=>{if(""===e){const e=j.reduce(((e,a)=>{const t=v.filter((e=>"Driver"===e.designation&&e.parentCompany===a.userName));return t.length>0&&(e[a.userName]=t),e}),{});f(e)}},onSelect:e=>{const a=e.id,t=j.reduce(((e,t)=>{const s=v.filter((e=>"Driver"===e.designation&&e.parentCompany===t.userName&&e.id===a));return s.length>0&&(e[t.userName]=s),e}),{});f(t)}})}),(0,g.jsx)(N,{drivers:x,handleToggleCardPositionHandler:e.handleToggleCardPosition},x)]})},A=e=>{const a=JSON.parse(localStorage.getItem("geofenceData"))?JSON.parse(localStorage.getItem("geofenceData")):[],[t,n]=(0,s.useState)(a),[l,i]=(0,s.useState)([]),[c,r]=(0,s.useState)(""),o=(t.filter((e=>e.company.toLowerCase().includes(c.toLowerCase()))),t.reduce(((e,a)=>(e[a.company]||(e[a.company]=[]),e[a.company].push(a),e)),{})),d=t.map((e=>({id:e.id,name:e.name})));return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"d-flex mt-4 mb-4",children:(0,g.jsx)(m.ReactSearchAutocomplete,{items:d,className:"w-100",styling:{height:"30px",marginRight:"10px",fontSize:"12px",color:"#red"},onSelect:e=>{const t=a.filter((a=>a.id===e.id));n(t)}})}),(0,g.jsx)("div",{className:"d-flex flex-column p-2",style:{marginTop:".5rem",overflowY:"scroll"},children:(0,g.jsx)(S,{geoFences:o,handleToggleCardPositionHandler:e.handleToggleCardPosition})})]})},T=e=>{let{tabData:a,handleToggleCardPosition:t,isOutside:s,setVehicleIds:n,setVehicleStatus:l,vehicleCounts:i}=e;const c={name:"Company1",drivers:[{name:"driver1",timeStamp:"22-02-2024 3:00 PM",status:"running"},{name:"driver2",timeStamp:"22-02-2024 3:00 PM",status:"idle"},{name:"driver3",timeStamp:"22-02-2024 3:00 PM",status:"inactive"},{name:"driver4",timeStamp:"22-02-2024 3:00 PM",status:"running"},{name:"driver5",timeStamp:"22-02-2024 3:00 PM",status:"stopped"},{name:"driver6",timeStamp:"22-02-2024 3:00 PM",status:"stopped"},{name:"driver7",timeStamp:"22-02-2024 3:00 PM"}],allocatedDriver:4,notAllocatedDriver:3,totalDriver:7},r=[y,b,A];return(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)("div",{className:"default-tab outer-container ".concat(s?"toggleBarInside":"toggleBarOutside"),children:[(0,g.jsx)("button",{onClick:t,className:"driver_tracking_button",children:s?(0,g.jsx)(u.m6W,{}):(0,g.jsx)(u.OQo,{})}),(0,g.jsxs)(d.A.Container,{defaultActiveKey:a[0].name.toLowerCase(),children:[(0,g.jsx)(h.A,{as:"ul",className:"nav-tabs tracking_navTabs",children:a.map(((e,a)=>{const t=e.icon;return(0,g.jsx)(h.A.Item,{as:"li",children:(0,g.jsxs)(h.A.Link,{eventKey:e.name.toLowerCase(),children:[(0,g.jsx)(t,{className:"tab-icon"}),e.name]})},a)}))}),(0,g.jsx)(d.A.Content,{className:"p-2 py-4",style:{background:"#f5f5f5",overflow:"scroll",height:"100vh"},children:a.map(((e,a)=>{const s=r[a];return(0,g.jsx)(d.A.Pane,{eventKey:e.name.toLowerCase(),children:(0,g.jsx)(s,{data:c,handleToggleCardPosition:t,setVehicleIds:n,setVehicleStatus:l,vehicleCounts:i})},a)}))})]})]})})};var I=t(40399),D=t(34713);const O=()=>{var e;const{t:a}=(0,c.Bd)(),[t,d]=(0,s.useState)(!0),h=[{name:"Object",icon:i.ETQ},{name:"Driver",icon:n.x$1},{name:"Geofence",icon:l.vVi}],[u,m]=(0,s.useState)([]),[p,v]=(0,s.useState)(""),{data:x}=(0,r.I)({queryKey:["tracking",u.join(","),p],queryFn:()=>(0,D.Up)(u.map((e=>"id=".concat(e,"&"))).join(""),p),staleTime:12e4,refetchInterval:12e4,refetchOnWindowFocus:"always"});return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(I.A,{mainTitle:a("vehicleTracking"),pageTitle:a("vehicleTracking"),parentTitle:a("tracking")}),(0,g.jsx)("div",{className:"backdrop ".concat(t?"d-none":"d-block"),onClick:()=>d(!0)}),(0,g.jsx)("div",{className:"p-2",children:(0,g.jsx)(o.A,{data:[{lat:30.7099475,lng:76.6900474},{lat:30.7333,lng:76.7794}],trackingData:null===x||void 0===x?void 0:x.data,centerCoordinate:null===x||void 0===x?void 0:x.centerCoordinate})}),(0,g.jsx)(T,{tabData:h,setVehicleIds:m,vehicleIds:u,setVehicleStatus:v,vehicleCounts:null!==(e=null===x||void 0===x?void 0:x.count)&&void 0!==e?e:{},handleToggleCardPosition:()=>{d(!t)},isOutside:t})]})}}}]);
//# sourceMappingURL=4627.803f7765.chunk.js.map