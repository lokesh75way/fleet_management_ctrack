"use strict";(self.webpackChunkFLEET=self.webpackChunkFLEET||[]).push([[1530],{1530:(e,a,l)=>{l.r(a),l.d(a,{default:()=>V});var s=l(78109),t=l(74563),n=l(34242),r=l(29419),o=l(46121),i=l(96833),c=l(85548),d=l(32457),u=l(90118),m=l(74797),p=l(32749),g=l(37191),h=l(67236),x=l(47337);function v(e){let{watch:a,setValues:l,getValues:t}=e;const n=(0,s.useRef)(null),{id:r}=(0,h.g)(),[i,c]=(0,s.useState)([]),[v,f]=(0,s.useState)([]),[y,j]=(0,s.useState)([]),[b,N]=(0,s.useState)([]),S=a("location");return(0,s.useEffect)((()=>{(()=>{const e=t("location");c([]),N([]),j([]),f([]),null===e||void 0===e||e.map((e=>{"Circle"===e.type&&c((a=>[...a,e])),"Polygon"===e.type&&j((a=>[...a,e])),"Point"===e.type&&N((a=>[...a,e])),"LineString"===e.type&&f((a=>[...a,e]))}))})()}),[S]),(0,x.jsxs)(u.m,{ref:n,children:[null===i||void 0===i?void 0:i.map(((e,a)=>(0,x.jsx)(m.j,{center:e.coordinates,radius:null===e||void 0===e?void 0:e.duration,id:e.id},e.id))),null===b||void 0===b?void 0:b.map(((e,a)=>(0,x.jsx)(o.p,{id:e.id,position:e.coordinates},e.id))),null===y||void 0===y?void 0:y.map(((e,a)=>(0,x.jsx)(p.t,{id:e.id,pathOptions:{color:"red"},positions:e.coordinates},e.id))),null===v||void 0===v?void 0:v.map(((e,a)=>(0,x.jsx)(g.R,{positions:e.coordinates,path:e.coordinates,id:e.id},e.id))),(0,x.jsx)(d.M,{position:"topright",onEdited:e=>{var a;let s=null!==(a=t("location"))&&void 0!==a?a:[];e.layers.eachLayer((e=>{let{editing:a,options:t}=e;s=s.map((e=>{if(t.id!==e.id)return e;if(e&&"Polygon"===e.type){const l=null===a||void 0===a?void 0:a.latlngs[0][0].map((e=>[e.lat,e.lng]));return e.id===t.id?{...e,coordinates:l}:e}if(e&&"Circle"===e.type){const l=[a._shape._latlng.lat,a._shape._latlng.lng],s=a._shape._mRadius;return e.id===t.id?{...e,coordinates:l,duration:s}:e}if(e&&"LineString"===e.type){const l=null===a||void 0===a?void 0:a.latlngs[0].map((e=>[e.lat,e.lng]));return e.id===t.id?{...e,coordinates:l}:e}if(e&&"Point"===e.type){const l=[a._marker._latlng.lat,a._marker._latlng.lng];return e.id===t.id?{...e,coordinates:l}:e}})),l("location",s)}))},onCreated:e=>{var a;const{layerType:s,layer:n}=e,{_latlng:r}=n;let o={};if("circle"===s)o={id:n._leaflet_id,type:"Circle",coordinates:[r.lat,r.lng],duration:n._mRadius};else if("polygon"===s){const e=n._latlngs[0].map((e=>[e.lat,e.lng]));o={id:n._leaflet_id,type:"Polygon",coordinates:e}}else if("marker"===s)o={type:"Point",id:n._leaflet_id,coordinates:[n._latlng.lat,n._latlng.lng]};else if("polyline"===s){const e=n._latlngs.map((e=>[e.lat,e.lng]));o={id:n._leaflet_id,type:"LineString",coordinates:e}}const i=null!==(a=t("location"))&&void 0!==a?a:[];l("location",[...i,o])},onDeleted:e=>{var a;let s=null!==(a=t("location"))&&void 0!==a?a:[];e.layers.eachLayer((e=>{s=s.filter((a=>a.id!==e.options.id))})),l("location",s)},draw:{rectangle:!1,circle:!0,polyline:!0,polygon:!0,marker:!0,circlemarker:!1},edit:{edit:!0,remove:!0}})]})}const f=e=>{var a,l;let{geofenceHanlder:t,setValue:d,watch:u,getValues:m,errors:p}=e;const[g,h]=s.useState({type:"FeatureCollection",features:[]}),f=null!==(a=null===(l=u("location"))||void 0===l?void 0:l.length)&&void 0!==a?a:0;return(0,x.jsx)("div",{style:{display:"flex",height:"85vh",border:p.location?"3px solid #ff5e5e":null},children:(0,x.jsx)("div",{style:{width:"100%"},children:(0,x.jsxs)(n.W,{center:[25.2233,55.2869],zoom:14,zoomControl:!1,children:[(0,x.jsx)(r.e,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png"}),(0,x.jsxs)(o.p,{styles:{background:"red"},position:[25.2233,55.2869],children:[(0,x.jsx)(i.z,{children:"Dubai Trade Center"}),(0,x.jsx)(c.m,{children:"Dubai Trade Center"})]}),(0,x.jsx)(v,{setValues:d,geofenceHanlder:t,watch:u,getValues:m},f)]})})})};var y=l(91197),j=l(86554),b=l(53252),N=l(44988),S=l(20460),A=l(85389),C=l(75542),_=l(70529),k=l(1763),w=l(34571),I=l(63226);const V=()=>{const[e,a]=(0,s.useState)(null),[l,n]=(0,s.useState)(),[r,o]=(0,s.useState)(),[i,c]=(0,s.useState)(null),d=(0,h.Zp)(),{id:u}=(0,h.g)(),[m,p]=(0,s.useState)(),[g,v]=(0,s.useState)(!1),V=JSON.parse(localStorage.getItem("userDetails")),F={control:e=>({...e,padding:".25rem 0 "})};(0,s.useEffect)((()=>{"COMPANY"===V.user.role&&(D("businessGroupId",null===V||void 0===V?void 0:V.user.businessGroupId),c(null===V||void 0===V?void 0:V.user.businessGroupId),D("companyId",null===V||void 0===V?void 0:V.user.companyId),p(null===V||void 0===V?void 0:V.user.companyId),v(!0)),"BUSINESS_GROUP"===V.user.role&&(D("businessGroupId",null===V||void 0===V?void 0:V.user.businessGroupId),c(null===V||void 0===V?void 0:V.user.businessGroupId)),u&&(async()=>{if(u){const{data:e}=await(0,k.LN)(u);n(e),T(e),a(e.geofenceAccess)}})()}),[u]);const{register:L,formState:{errors:P},setValue:D,watch:E,getValues:G,control:O,handleSubmit:R,reset:T}=(0,j.mN)({resolver:(0,b.t)(N._8),defaultValues:{category:S.rF[0].value,tolerance:S.gY[0].value}}),z=e=>{a(e.target.value),D("geofenceAccess",e.target.value)},U=async e=>{try{if(u){const{success:a}=await(0,k.ck)(u,e);return void(a&&((0,_.V)("Geofence updated successfully!"),d("/settings/geofence")))}{const{success:a}=await(0,k.vo)(e);return void(a&&((0,_.V)("New Geofence Created!"),d("/settings/geofence")))}}catch(a){return console.log(a),void(0,_.U)("Some error occured !!")}},$=JSON.parse(localStorage.getItem("geofenceData")),B=null===$||void 0===$?void 0:$.filter((e=>e.id==u)),[M,q]=(0,s.useState)(B),{t:Y}=(0,w.Bd)();return(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{style:{padding:"10px",backgroundColor:"#FFFDFD"},children:(0,x.jsxs)("h2",{style:{fontSize:"20px"},children:[Y("geofenceDetail"),"l"]})}),(0,x.jsxs)("div",{className:"",style:{display:"flex",height:"88vh"},children:[(0,x.jsx)("div",{className:"col-md-3",style:{padding:"15px",boxShadow:"9px 0 4px rgba(0, 0, 0, 0.1)",backgroundColor:"#fff",overflow:"auto"},children:(0,x.jsx)(j.Op,{children:(0,x.jsxs)("form",{onSubmit:R(U),children:[(0,x.jsxs)("div",{className:"mb-2",children:[(0,x.jsxs)("label",{htmlFor:"company",className:"form-label",children:[Y("company"),":",(0,x.jsx)("span",{className:"text-danger",children:"*"})]}),(0,x.jsx)(j.xI,{name:"company",control:O,rules:{required:!0},render:e=>{let{field:{onChange:a,value:l,name:s,ref:t}}=e;return(0,x.jsx)(I.A,{groupId:i,onChange:e=>{D("company",e.value),D("companyName",e.value),p(e.value)},value:l,customStyles:F,ref:t,isDisabled:g,name:s},i)}}),(0,x.jsx)(C.A,{errorName:P.company})]}),(0,x.jsxs)("div",{className:"mb-2",children:[(0,x.jsxs)("label",{htmlFor:"company",className:"form-label",children:[Y("name"),":",(0,x.jsx)("span",{className:"text-danger",children:"*"})]}),(0,x.jsx)(y.A,{type:"text",label:"Name",register:L,name:"name"}),(0,x.jsx)(C.A,{errorName:P.name})]}),(0,x.jsxs)("div",{className:"mb-3",children:[(0,x.jsxs)("label",{className:"form-label",children:[Y("category"),":",(0,x.jsx)("span",{className:"text-danger",children:"*"})]}),(0,x.jsx)(j.xI,{name:"category",control:O,rules:{required:!0},render:e=>{let{field:{onChange:a,value:l,name:s,ref:n}}=e;return(0,x.jsx)(t.Ay,{onChange:e=>{o(e.value),D("category",e.value)},options:S.rF,ref:n,name:s,styles:F,value:{value:l,label:l}})}}),!G("category")&&(0,x.jsx)(C.A,{errorName:P.category})]}),(0,x.jsxs)("div",{className:"mb-3",children:[(0,x.jsxs)("label",{className:"form-label",children:[Y("geofenceAccess"),":",(0,x.jsx)("span",{className:"text-danger",children:"*"})]}),(0,x.jsxs)("div",{style:{display:"flex",flexDirection:"row",gap:"5rem"},children:[(0,x.jsxs)("div",{className:"form-check",children:[(0,x.jsx)("input",{type:"radio",className:"form-check-input",value:"PUBLIC",checked:"PUBLIC"===e,onChange:z}),(0,x.jsx)("label",{className:"form-check-label",children:Y("public")})]}),(0,x.jsxs)("div",{className:"form-check",children:[(0,x.jsx)("input",{type:"radio",className:"form-check-input",value:"PRIVATE",checked:"PRIVATE"===e,onChange:z}),(0,x.jsx)("label",{className:"form-check-label",children:Y("private")})]})]}),!G("geofenceAccess")&&(0,x.jsx)(C.A,{errorName:P.geofenceAccess})]}),(0,x.jsxs)("div",{className:"mb-3",children:[(0,x.jsxs)("label",{htmlFor:"contactNumber",className:"form-label",children:[Y("contactNumber"),":",(0,x.jsx)("span",{className:"text-danger",children:"*"})]}),(0,x.jsx)(y.A,{type:"number",register:L,label:"Contact Number",name:"contactNumber",min:"0",onInput:e=>{const a=Math.max(0,e.target.value);e.target.value=a<1?"":a}}),(0,x.jsx)(C.A,{errorName:P.contactNumber})]}),(0,x.jsxs)("div",{className:"mb-3",children:[(0,x.jsxs)("label",{htmlFor:"address",className:"form-label",children:[Y("address"),":"]}),(0,x.jsx)("textarea",{className:"form-control",...L("address"),label:"Address",name:"address"})]}),(0,x.jsxs)("div",{className:"mb-3",children:[(0,x.jsxs)("label",{className:"form-label",children:[Y("tolerance"),":",(0,x.jsx)("span",{className:"text-danger",children:"*"})]}),(0,x.jsx)(j.xI,{name:"tolerance",control:O,rules:{required:!0},render:e=>{let{field:{onChange:a,value:l,name:s,ref:n}}=e;return(0,x.jsx)(t.Ay,{onChange:e=>{o(e.value),D("tolerance",e.value)},options:S.gY,ref:n,name:s,styles:F,value:{label:l,value:l}})}}),!G("tolerance")&&(0,x.jsx)(C.A,{errorName:P.tolerance})]}),(0,x.jsxs)("div",{className:"mb-3",children:[(0,x.jsxs)("label",{className:"form-label",children:[Y("description"),":"]}),(0,x.jsx)("textarea",{className:"form-control",...L("description"),name:"description",label:"Description"})]}),!G("location")&&(0,x.jsx)(C.A,{errorName:P.location}),(0,x.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"center",margin:"2rem 0"},children:(0,x.jsxs)(A.A,{type:"submit",onClick:R(U),children:[" ",Y("submit")]})})]})})}),(0,x.jsx)("div",{className:"col-md-9",style:{paddingLeft:"15px"},children:(0,x.jsx)(f,{setValue:D,watch:E,getValues:G,defaultValues:l,errors:P})})]})]})}},1763:(e,a,l)=>{l.d(a,{LN:()=>o,bx:()=>t,ck:()=>i,mG:()=>n,vo:()=>r});var s=l(74763);const t=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return(await s.A.get(`/geofences?page=${e}&limit=${a}`)).data.data},n=async e=>{const{data:a}=await s.A.delete(`/geofences/${e}`);return a},r=async e=>{const{data:a}=await s.A.post("/geofences",e);return a},o=async e=>{const{data:a}=await s.A.get(`/geofences/${e}`);return a},i=async(e,a)=>{const{data:l}=await s.A.patch(`/geofences/${e}`,a);return l}}}]);
//# sourceMappingURL=1530.c2d02436.chunk.js.map