"use strict";(self.webpackChunkFLEET=self.webpackChunkFLEET||[]).push([[2799],{22799:(e,a,s)=>{s.r(a),s.d(a,{default:()=>T});var l=s(65043),r=s(73216),t=s(44816),n=s(86856),o=s(24858),i=(s(9531),s(9866)),d=s(14282),c=s(2364),u=s(23764),m=s(69367),p=s(13052),v=s(59167),h=(s(72213),s(86151)),b=(s(272),s(35514)),x=s(74117),f=s(42457),g=s(89698),N=s(13931),y=s(42617),j=s(66948),S=s(85539),I=s(12954),w=s(52294),C=s(70579);const A=e=>{let{handleNext:a,register:s,setValue:t,onSubmit:n,handleSubmit:i,getValues:A,errors:_,control:U}=e;console.log(_);const[E,T]=(0,l.useState)(""),[G,O]=(0,l.useState)(""),[P,B]=(0,l.useState)([]),[V,k]=(0,l.useState)([]),[D,J]=(0,l.useState)([]),{checkRole:F,checkUser:M}=(0,v.A)(),[L,R]=(0,l.useState)(),[q,H]=(0,l.useState)(0),[K,Y]=(0,l.useState)(0),[Z,W]=(0,l.useState)(!0),[Q,z]=(0,l.useState)([]),[X,$]=(0,l.useState)(!1),[ee,ae]=(0,l.useState)(!1),[se,le]=(0,l.useState)(!0),[re,te]=(0,l.useState)(!1),[ne,oe]=(0,l.useState)(null),[ie,de]=(0,l.useState)(null),ce=JSON.parse(localStorage.getItem("userDetails")),{t:ue}=(0,x.Bd)(),me={control:e=>({...e,padding:"0.25rem 0 "})};(0,l.useEffect)((()=>{le(!0),(async()=>{const e=await(0,N.f)(),a=await(0,y.C1)(),s=await(0,j.e3)();if(e.error)(0,f.U)(e.error);else{const a=e.data;B(a);const s=a.map((e=>{var a,s;return{label:null===e||void 0===e||null===(a=e.businessGroupId)||void 0===a?void 0:a.groupName,value:null===e||void 0===e||null===(s=e.businessGroupId)||void 0===s?void 0:s._id}}));we(s)}if(a.error)(0,f.U)(a.error);else{const e=a.data.data.data;e.map((e=>{var a,s;return{label:null===(a=e.companyId)||void 0===a?void 0:a.companyName,value:null===(s=e.companyId)||void 0===s?void 0:s._id}}));k(e)}if(s.error)(0,f.U)(s.error);else{const e=s.data.data,a=e.map((e=>({label:e.branchName,value:e._id})));J(e),Te(a)}le(!1)})()}),[]),(0,l.useEffect)((()=>{(async()=>{const e=await(0,b.y)();if(e.error)(0,f.U)(e.error);else{const a=e.data.data.map((e=>({label:e.name,value:e._id})));z(a)}})()}),[]);const pe=F(),{id:ve}=(0,r.g)(),he=JSON.parse(localStorage.getItem("userJsonData")),be=localStorage.getItem("loginDetails-name");let xe,fe;if(xe="SUPER_ADMIN"===pe?h.filter((e=>"company"===e.role)).map((e=>({label:e.userName,value:e._id}))):h.filter((e=>"company"===e.role&&e.parent===be)).map((e=>({label:e.userName,value:e._id}))),"COMPANY"===pe){var ge;fe=null===(ge=he.filter((e=>e.parentCompany===be))[0])||void 0===ge?void 0:ge.parentBusinessGroup}const Ne=he.filter((e=>"branch"===e.role&&e._id==ve)),ye=JSON.parse(localStorage.getItem("userJsonData")).filter((e=>e._id==ve)),[je,Se]=(0,l.useState)(ye),[Ie,we]=(0,l.useState)([]),[Ce,Ae]=(0,l.useState)([]),[_e,Ue]=(0,l.useState)([]),[Ee,Te]=(0,l.useState)([]),[Ge,Oe]=(0,l.useState)([]),[Pe,Be]=(0,l.useState)(),[Ve,ke]=(0,l.useState)([]),[De,Je]=(0,l.useState)(),[Fe,Me]=(0,l.useState)(!1),[Le,Re]=(0,l.useState)(!1);(0,l.useEffect)((()=>{let e,a,s;e="BUSINESS_GROUP"===pe?h.filter((e=>"company"===e.role)).filter((e=>e.parent===M())).map((e=>({label:e.userName,value:e._id}))):h.filter((e=>"company"===e.role)).filter((e=>e.parent===Pe)).map((e=>({label:e.userName,value:e._id}))),a="COMPANY"===pe?h.filter((e=>"branch"===e.role)).filter((e=>e.parentCompany===M())).map((e=>({label:e.userName,value:e._id}))):h.filter((e=>"branch"===e.role)).filter((e=>e.parentCompany===Ve)).map((e=>({label:e.userName,value:e._id}))),s="COMPANY"===pe?h.filter((e=>e.vehicleName&&e.company===M())).map((e=>({label:e.vehicleName,value:e._id}))):h.filter((e=>e.vehicleName&&e.company===Ve)).map((e=>({label:e.vehicleName,value:e._id}))),e.push({label:"None",value:0}),Oe(s),Te(a)}),[Pe,Ve,De]);const[qe,He]=(0,l.useState)(Ne);return(0,l.useEffect)((()=>{"COMPANY"===ce.user.role&&(t("businessGroupId",null===ce||void 0===ce?void 0:ce.user.businessGroupId),t("businessUser",null===ce||void 0===ce?void 0:ce.user.businessGroupId),oe(null===ce||void 0===ce?void 0:ce.user.businessGroupId),Me(!0),t("parentCompany",null===ce||void 0===ce?void 0:ce.user.companyId),de(null===ce||void 0===ce?void 0:ce.user.companyId),Re(!0),console.log("parentCompany",null===ce||void 0===ce?void 0:ce.user.businessGroupId)),"BUSINESS_GROUP"===ce.user.role&&(oe(null===ce||void 0===ce?void 0:ce.user.businessGroupId),t("businessUser",null===ce||void 0===ce?void 0:ce.user.businessGroupId),console.log(null===ce||void 0===ce?void 0:ce.user.businessGroupId,"dsggsgs"),Me(!0))}),[]),(0,l.useEffect)((()=>{var e;const a=null===(e=je[0])||void 0===e?void 0:e._id;if(te(!!a),a){var s,l,r,n,o;const m=null===(s=je[0])||void 0===s?void 0:s.featureTemplateId,p=null===(l=je[0])||void 0===l?void 0:l.businessGroupId,v=null===(r=je[0])||void 0===r?void 0:r.companyId,h=null===(n=je[0])||void 0===n?void 0:n.branchIds;var i,d,c,u;if(t("featureTemplateId",m),t("businessUser",p),console.log("selectedGroupId",p),b(),t("parentCompany",v),t("Branch",h),t("branchIds",h),t("parentBusinessGroup",qe[0]?qe[0].parentBusinessGroup:""),t("parentBranch",qe[0]?qe[0].parentBranch:""),a)t("country",je[0]?null===(i=je[0])||void 0===i?void 0:i.country:""),O({name:null===(d=je[0])||void 0===d?void 0:d.country}),t("state",je[0]?null===(c=je[0])||void 0===c?void 0:c.state:""),T({name:(null===(u=je[0])||void 0===u?void 0:u.state)||""});async function b(){await async function(e){console.log("groupId",e),console.log("allCompanies",V);const a=V.filter((a=>{var s,l;return(null===a||void 0===a||null===(s=a.companyId)||void 0===s||null===(l=s.businessGroupId)||void 0===l?void 0:l._id)==e})).map((e=>{var a,s;return{value:null===e||void 0===e||null===(a=e.companyId)||void 0===a?void 0:a._id,label:null===e||void 0===e||null===(s=e.companyId)||void 0===s?void 0:s.companyName}}));Ae(a),t("parentCompany",""),Ue([])}(p),await async function(e){const a=D.filter((a=>{var s;return(null===a||void 0===a||null===(s=a.companyId)||void 0===s?void 0:s._id)==e})).map((e=>({value:null===e||void 0===e?void 0:e._id,label:null===e||void 0===e?void 0:e.branchName})));Ue(a)}(v)}t("_id",je[0]?null===(o=je[0])||void 0===o?void 0:o._id:a)}t("isEdit",re)}),[Q,D,V,P]),se?(0,C.jsx)("div",{children:"Loading..."}):(0,C.jsxs)("div",{className:"p-4",children:[(0,C.jsxs)("div",{className:"row",style:{width:"70%",margin:"auto"},children:[(0,C.jsxs)("div",{className:"col-xl-6 mb-3",children:[(0,C.jsx)("label",{className:"form-label",children:ue("businessGroup")}),(0,C.jsx)(o.xI,{name:"businessUser",control:U,rules:{required:!0},render:e=>{let{field:{onChange:a,value:s,name:l,ref:r}}=e;return(0,C.jsx)(w.A,{onChange:async e=>{t("businessUser",e.value),oe(e.value),de(null)},value:s,customStyles:me,ref:r,isDisabled:Fe,name:l},ne)}})]}),(0,C.jsxs)("div",{className:"col-xl-6 mb-3",children:[(0,C.jsx)("label",{className:"form-label",children:ue("company")}),(0,C.jsx)(o.xI,{name:"parentCompany",control:U,rules:{required:!0},render:e=>{let{field:{onChange:a,value:s,name:l,ref:r}}=e;return(0,C.jsx)(I.A,{onChange:async e=>{t("parentCompany",e.value),de(e.value)},groupId:ne,value:s,customStyles:me,name:l,ref:r,isDisabled:Le},ne)}})]}),(0,C.jsxs)("div",{className:"col-xl-6 mb-3",children:[(0,C.jsx)("label",{className:"form-label",children:ue("branch")}),(0,C.jsx)(o.xI,{name:"Branch",control:U,rules:{required:!0},render:e=>{let{field:{onChange:a,value:s,name:l,ref:r}}=e;return(0,C.jsx)(S.A,{onChange:e=>{console.log("newValue",e);const a=e.map((e=>e.value));t("Branch",a),t("branchIds",a)},companyId:ie,value:s,customStyles:me,name:l,ref:r,isDisabled:!1},ie)}}),!A("Branch")&&(0,C.jsx)(u.A,{errorName:_.parent})]}),(0,C.jsxs)("div",{className:"col-xl-6 mb-3",children:[(0,C.jsxs)("label",{htmlFor:"exampleFormControlInput3",className:"form-label",children:[ue("email")," ",(0,C.jsx)("span",{className:"text-danger",children:"*"})]}),(0,C.jsx)(m.A,{type:"email",register:s,label:"Email",className:"form-control",name:"email",defaultValue:je[0]?je[0].email:"",placeholder:""}),(0,C.jsx)(u.A,{errorName:_.email})]}),(0,C.jsxs)("div",{className:"col-xl-6 mb-3 ",children:[(0,C.jsxs)("label",{className:"form-label",children:[ue("username")," ",(0,C.jsx)("span",{className:"text-danger",children:"*"})]}),(0,C.jsx)(m.A,{type:"text",register:s,label:"User Name",name:"userName",placeholder:"",defaultValue:je[0]?je[0].userName:""}),(0,C.jsx)(u.A,{errorName:_.userName})]}),(0,C.jsxs)("div",{className:"col-xl-6 mb-3 ",children:[(0,C.jsxs)("label",{className:"form-label",children:[ue("mobileNumber")," ",(0,C.jsx)("span",{className:"text-danger",children:"*"})]}),(0,C.jsx)(m.A,{type:"text",register:s,label:"Mobile Number",name:"mobileNumber",min:"0",onInput:e=>{const a=Math.max(0,e.target.value);e.target.value=a<1?"":a},placeholder:"",defaultValue:je[0]?je[0].mobileNumber:""}),(0,C.jsx)(u.A,{errorName:_.mobileNumber})]}),(0,C.jsxs)("div",{className:"col-xl-6 mb-3",children:[(0,C.jsxs)("label",{className:"form-label",children:[ue("country"),(0,C.jsx)("span",{className:"text-danger",children:"*"})]}),(0,C.jsx)(p.b3,{onChange:e=>{T({name:""}),H(e.id),t("country",e.name),W(!1)},containerClassName:"bg-white",inputClassName:"border border-white customSelectHeight",placeHolder:"Select Country",defaultValue:G}),!A("country")&&(0,C.jsx)(u.A,{errorName:_.country})]}),(0,C.jsxs)("div",{className:"".concat(Z?"col-xl-6 mb-3 pe-none":"col-xl-6 mb-3"),children:[(0,C.jsx)("label",{className:"form-label",children:ue("state")}),(0,C.jsx)("div",{style:{background:"white"},children:(0,C.jsx)(p.QO,{countryid:q,onChange:e=>{Y(e.id),t("state",e.name)},containerClassName:"bg-white",inputClassName:"border border-white customSelectHeight",placeHolder:"Select State",defaultValue:E})}),!A("state")&&(0,C.jsx)(u.A,{errorName:_.state})]}),!re&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)("div",{className:"col-xl-6 mb-3 ",children:[(0,C.jsxs)("label",{className:"form-label",children:[ue("password")," ",(0,C.jsx)("span",{className:"text-danger",children:"*"})]}),(0,C.jsxs)("div",{className:"position-relative",children:[(0,C.jsx)(m.A,{type:X?"text":"password",register:s,label:"Password",name:"password",placeholder:"",defaultValue:je[0]?je[0].password:""}),(0,C.jsx)("span",{className:"showPasswordIcon",onClick:()=>{$(!X)},children:X?(0,C.jsx)(g.mI_,{}):(0,C.jsx)(g.ZT8,{})})]}),(0,C.jsx)(u.A,{errorName:_.password})]}),(0,C.jsxs)("div",{className:"col-xl-6 mb-3 ",children:[(0,C.jsxs)("label",{className:"form-label",children:[ue("confirmPassword")," ",(0,C.jsx)("span",{className:"text-danger",children:"*"})]}),(0,C.jsxs)("div",{className:"position-relative",children:[(0,C.jsx)(m.A,{type:ee?"text":"password",register:s,label:"Confirm Password",name:"confirmPassword",placeholder:"",defaultValue:je[0]?je[0].confirmPassword:""}),(0,C.jsx)("span",{className:"showPasswordIcon",onClick:()=>{ae(!ee)},children:ee?(0,C.jsx)(g.mI_,{}):(0,C.jsx)(g.ZT8,{})})]}),(0,C.jsx)(u.A,{errorName:_.confirmPassword})]})," "]}),(0,C.jsxs)("div",{className:"col-xl-6 mb-3 ",children:[(0,C.jsxs)("label",{className:"form-label",children:[ue("featureTemplate")," ",(0,C.jsx)("span",{className:"text-danger",children:"*"})]}),(0,C.jsx)(o.xI,{name:"featureTemplateId",control:U,rules:{required:!0},render:e=>{let{field:a}=e;return(0,C.jsx)(c.Ay,{onChange:e=>{R(e),t("featureTemplateId",e.value)},options:Q,ref:a.ref,name:a.name,styles:me,value:Q.find((e=>e.value===a.value))})}}),!A("featureTemplateId")&&(0,C.jsx)(u.A,{errorName:_.featureTemplateId})]}),(0,C.jsx)("div",{className:"col-xl-6 mb-3 "})]}),(0,C.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"center",margin:"2rem 0"},children:(0,C.jsxs)(d.A,{type:"submit",onClick:i(n),style:{width:"10%"},children:[" ",ue("submit")]})})]})};var _=s(18403),U=s(87742),E=s(78919);const T=e=>{let{Title:a,editData:s,setEditData:d}=e;const{t:c}=(0,x.Bd)(),[u,m]=(0,l.useState)(0),{checkRole:p,checkUserName:h}=(0,v.A)(),b=(p(),h()),g=[c("account")],N=[A],y=(g.length,(0,r.Zp)()),{register:j,formState:{errors:S},setValue:I,getValues:w,control:T,handleSubmit:G}=(0,o.mN)({resolver:(0,_.t)(U.it)}),O=async e=>{if(console.log(e,"this is data"),e.businessUser&&(e.businessGroupId=e.businessUser),e.parentCompany&&(e.companyId=e.parentCompany),e.Branch&&(console.log(e.Branch),e.branchId=e.Branch),console.log(e,"this is data"),e.hasOwnProperty("_id")&&e._id)try{const a=JSON.parse(localStorage.getItem("userJsonData")),s=a.findIndex((a=>a._id===e._id));a[s]={...a[s],...e};const l=await(0,E.TK)(e,e._id);console.log("this is updateResponse",l),l.error?(0,f.U)(l.error):(localStorage.setItem("userJsonData",JSON.stringify(a)),(0,f.V)("User updated successfully !!"),y("/subUser"))}catch(a){(0,f.U)("Error Occured !!")}else try{const a=JSON.parse(localStorage.getItem("userJsonData"));e.role="USER",e.parent=b,e.type="STAFF";const s=await(0,E.kg)(e);console.log("this is response",s),s.error?(0,f.U)(s.error):(e._id=s._id,a.unshift(e),localStorage.setItem("userJsonData",JSON.stringify(a)),(0,f.V)("User created successfully !!"),y("/subUser"))}catch(a){(0,f.U)("Something Went Wrong")}},{id:P}=(0,r.g)();return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(i.A,{mainTitle:"User",pageTitle:P?"Edit":"Create",parentTitle:"User"}),(0,C.jsx)("div",{className:"m-2 p-2",children:(0,C.jsx)(o.Op,{children:(0,C.jsx)("form",{onSubmit:G(O),children:(0,C.jsx)("div",{className:"default-tab",children:(0,C.jsxs)(t.A.Container,{defaultActiveKey:g[0].toLowerCase(),children:[(0,C.jsx)(n.A,{as:"ul",className:"nav-tabs",children:g.map(((e,a)=>(0,C.jsx)(n.A.Item,{as:"li",children:(0,C.jsx)(n.A.Link,{style:{padding:".5rem 2rem"},eventKey:e.toLowerCase(),active:a===u,onClick:()=>m(a),children:e})},a)))}),(0,C.jsx)(t.A.Content,{className:"pt-4",children:g.map(((e,a)=>{const s=N[a];return(0,C.jsx)(t.A.Pane,{eventKey:e.toLowerCase(),active:a===u,children:(0,C.jsx)(s,{data:g,control:T,setValue:I,register:j,getValues:w,errors:S,onSubmit:O,handleSubmit:G})},a)}))})]})})})})})]})}},35514:(e,a,s)=>{s.d(a,{A:()=>n,y:()=>t});s(99080);var l=s(88472),r=s(77154);(0,l.A)();const t=async e=>{try{console.log("page is here ",e);let a="/feature-template";void 0!==e&&(a+="?page=".concat(e,"&limit=",10));return(await r.A.get(a)).data}catch(a){return console.error("Error fetching templates:",a),{error:"Couldn't fetch User"}}},n={getTemplates:async e=>{try{return(await r.A.get("/feature-template",e)).data}catch(a){throw console.error("Error fetching modules:",a),a}},createTemplate:async e=>{try{console.log(e);return(await r.A.post("/feature-template",e)).data}catch(a){throw console.error("Error fetching modules:",a),a}},listModule:async e=>{try{return(await r.A.get("/modules",e)).data}catch(a){throw console.error("Error fetching modules:",a),a}},udpateTemplate:async e=>{try{return(await r.A.patch("/feature-template",e)).data}catch(a){throw console.error("Error fetching modules:",a),a}},deleteTemplate:async e=>{try{return(await r.A.delete("/feature-template/".concat(e))).data}catch(a){throw console.error("Error fetching modules:",a),a}}}}}]);
//# sourceMappingURL=2799.c6871376.chunk.js.map