"use strict";(self.webpackChunkFLEET=self.webpackChunkFLEET||[]).push([[3925],{19889:(e,a,t)=>{t.d(a,{Up:()=>r,e:()=>n,f7:()=>c,ih:()=>i,lp:()=>l,nz:()=>o});var s=t(95441);const n=async e=>s.S.post("/vehicles",e),l=async(e,a)=>{let t=`/vehicles?page=${e}&limit=10`;a&&(Array.isArray(a)?a.forEach((e=>{t+=`&branchIds=${e}`})):t+=`&branchIds=${a}`);const{data:n}=await s.S.get(t);return{data:n.data.data,totalCount:n.data.totalCount}},i=async e=>s.S.delete(`/vehicles/${e}`),c=async(e,a)=>s.S.patch(`/vehicles/${a}`,e),r=async(e,a)=>{const{data:t}=await s.S.get(`/vehicles/tracking?${e}&status=${a}`);return{data:t.data.data,count:t.data.count,centerCoordinate:t.data.centerCoordinate}},o=async e=>{var a;const{data:t}=await s.S.get(`/vehicles/${e}`);return null===t||void 0===t||null===(a=t.data)||void 0===a?void 0:a.data}},23925:(e,a,t)=>{t.r(a),t.d(a,{default:()=>w});var s=t(78109),n=t(25255),l=t(27515),i=t(17558),c=t(34571),r=t(67889),o=t(32343),d=t(22310),h=t(36145),u=t(93576),m=(t(7804),t(87388)),p=t(36379),v=(t(94713),t(93452)),g=t.n(v),x=t(85389),f=t(47337);const j=e=>{const[a,t]=(0,s.useState)([]),[n,l]=(0,s.useState)([]),[i,c]=(0,s.useState)([]);(0,s.useEffect)((()=>{const a=null===e||void 0===e?void 0:e.companyVehicle.map((e=>{var a;const t=null===e||void 0===e||null===(a=e.vehicles)||void 0===a?void 0:a.map((e=>({label:null===e||void 0===e?void 0:e.vehicleName,value:null===e||void 0===e?void 0:e._id})));return{value:null===e||void 0===e?void 0:e._id,label:null===e||void 0===e?void 0:e.companyName,children:t}}));c([...a])}),[e.companyVehicle]),(0,s.useEffect)((()=>{let e=[];null===i||void 0===i||i.map((a=>{var t;return null===(t=a.children)||void 0===t?void 0:t.map((a=>e.push(a.value)))}));r(e)}),[i]);const r=a=>{t(a),e.setVehicleIds(a)};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"checkboxTree",children:(0,f.jsx)(g(),{nodes:i,checked:a,expanded:n,onCheck:r,onExpand:e=>{l(e)},showNodeIcon:!1,icons:{expandOpen:(0,f.jsx)("i",{class:"fa-solid fa-minus"}),expandClose:(0,f.jsx)("i",{class:"fa-solid fa-plus"}),uncheck:(0,f.jsx)("i",{class:"fa-regular fa-square",style:{fontSize:"16px"}}),check:(0,f.jsx)("i",{class:"fa-solid fa-square-check",style:{fontSize:"16px"}}),halfCheck:(0,f.jsx)("i",{class:"fa-regular fa-square-minus",style:{fontSize:"16px"}})}})}),(0,f.jsx)("div",{className:"text-center  pt-2 ",children:(0,f.jsx)(x.A,{className:" mb-5",variant:"primary btn-md ",type:"submit",onClick:()=>{e.handleToggleCardPositionHandler()},children:"Save Selection"})})]})};var S=t(96152);const N=e=>{let{geoFences:a,handleToggleCardPositionHandler:t}=e;const[n,l]=(0,s.useState)([]),[i,c]=(0,s.useState)([]),[r,o]=(0,s.useState)([]);(0,s.useEffect)((()=>{const e=Object.entries(a).map((e=>{let[a,t]=e;return{value:a,label:a,children:t.map((e=>({label:e.name,value:e.id})))}}));o(e)}),[a]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"checkboxTree",children:(0,f.jsx)(g(),{nodes:r,checked:n,expanded:i,onCheck:e=>{l(e)},onExpand:e=>{c(e)},showNodeIcon:!1,icons:{expandOpen:(0,f.jsx)("i",{className:"fa-solid fa-minus"}),expandClose:(0,f.jsx)("i",{className:"fa-solid fa-plus"}),uncheck:(0,f.jsx)("i",{className:"fa-regular fa-square",style:{fontSize:"16px"}}),check:(0,f.jsx)("i",{className:"fa-solid fa-square-check",style:{fontSize:"16px"}}),halfCheck:(0,f.jsx)("i",{className:"fa-regular fa-square-minus",style:{fontSize:"16px"}})}})}),(0,f.jsx)("div",{className:"text-center  pt-2 ",children:(0,f.jsx)(x.A,{className:" mb-5",variant:"primary btn-md ",type:"submit",onClick:()=>{n.map((e=>JSON.parse(e)));t()},children:"Save Selection"})})]})},k=e=>{const[a,t]=(0,s.useState)([]),[n,l]=(0,s.useState)([]),[i,c]=(0,s.useState)([]);(0,s.useEffect)((()=>{const a=Object.entries(e.drivers).map((e=>{const a=e[1].map((e=>({label:e.firstName,value:e.id})));return{value:e[0],label:e[0],children:a}}));c([...a])}),[e.drivers]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"checkboxTree",children:(0,f.jsx)(g(),{nodes:i,checked:a,expanded:n,onCheck:e=>{t(e)},onExpand:e=>{l(e)},showNodeIcon:!1,icons:{expandOpen:(0,f.jsx)("i",{class:"fa-solid fa-minus"}),expandClose:(0,f.jsx)("i",{class:"fa-solid fa-plus"}),uncheck:(0,f.jsx)("i",{class:"fa-regular fa-square",style:{fontSize:"16px"}}),check:(0,f.jsx)("i",{class:"fa-solid fa-square-check",style:{fontSize:"16px"}}),halfCheck:(0,f.jsx)("i",{class:"fa-regular fa-square-minus",style:{fontSize:"16px"}})}})}),(0,f.jsx)("div",{className:"text-center  pt-2 ",children:(0,f.jsx)(x.A,{className:" mb-5",variant:"primary btn-md ",type:"submit",onClick:()=>{const t=a.map((e=>JSON.parse(e)));console.log(t,"selctedObject"),e.handleToggleCardPositionHandler()},children:"Save Selection"})})]})};var C=t(70529),y=t(55759);const b=e=>{var a,t;const{setVehicleStatus:n,vehicleCounts:l}=e,{running:i,idle:c,stopped:r,inactive:o,nodata:d,total:h}=l,[u,m]=(0,s.useState)("All"),[v,g]=(0,s.useState)([]),[x,N]=(0,s.useState)([]);(0,s.useEffect)((()=>{(async e=>{try{var a;const t=await(0,y.oq)(e);return void await N(null!==(a=null===t||void 0===t?void 0:t.data)&&void 0!==a?a:[])}catch(t){(0,C.U)("Some Error occured")}})()}),[u]);const k=JSON.parse(null===(a=localStorage)||void 0===a?void 0:a.getItem("userJsonData"))?JSON.parse(null===(t=localStorage)||void 0===t?void 0:t.getItem("userJsonData")).filter((e=>"vehicle"===e.designation)).map((e=>({id:e.id,name:e.vehicleName}))):[];return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"vehicle_tracking-object",children:[(0,f.jsxs)("span",{className:`light fs-9 running ${"Running"===u&&"vehicle_tracking-active"}`,onClick:()=>{m("Running"),n("RUNNING")},children:[(0,f.jsx)("p",{children:i}),(0,f.jsx)("span",{children:"Running"})]}),(0,f.jsxs)("span",{pill:!0,className:`light fs-9 idle ${"Idle"===u&&"vehicle_tracking-active"}`,onClick:()=>{m("Idle"),n("IDLE")},children:[(0,f.jsx)("p",{children:c}),(0,f.jsx)("span",{children:"Idle"})]}),(0,f.jsxs)("span",{pill:!0,className:`light stopped fs-9 ${"Stopped"===u&&"vehicle_tracking-active"}`,onClick:()=>{m("Stopped"),n("STOP")},children:[(0,f.jsx)("p",{children:r}),(0,f.jsx)("span",{children:"Stopped"})]}),(0,f.jsxs)("span",{pill:!0,className:`light fs-9 inActive ${"Inactive"===u&&"vehicle_tracking-active"}`,onClick:()=>{m("Inactive"),n("INACTIVE")},children:[(0,f.jsx)("p",{children:o}),(0,f.jsx)("span",{children:"InActive"})]}),(0,f.jsxs)("span",{pill:!0,className:`light fs-9 noData ${"NoData"===u&&"vehicle_tracking-active"}`,onClick:()=>{m("NoData"),n("NODATA")},children:[(0,f.jsx)("p",{children:d}),(0,f.jsx)("span",{children:"NoData"})]}),(0,f.jsxs)("span",{className:`light fs-9 total ${"All"===u&&"vehicle_tracking-active"}`,onClick:()=>{m("All"),n("")},children:[(0,f.jsx)("p",{children:h}),(0,f.jsx)("span",{children:"Total"})]})]}),(0,f.jsx)("div",{className:"d-flex mt-4 mb-4",children:(0,f.jsx)(p.ReactSearchAutocomplete,{items:k,className:"w-100",styling:{height:"30px",marginRight:"10px",fontSize:"12px",color:"#4A4646"},onSearch:e=>{if(""===e){const e=(0,S.kw)(u);g(e)}},onSelect:e=>{const a=(0,S.kw)(u),t=Object.entries(a).filter((a=>a[1].filter((a=>a.id==e.id)).length>0)).reduce(((a,t)=>{let[s,n]=t;return n.map((t=>{t.vehicleName===e.name&&(a[s]=[t])})),a}),{});g(t)}})}),(0,f.jsx)(j,{companyVehicle:null!==x&&void 0!==x?x:[],setVehicleIds:e.setVehicleIds,vehicles:v,handleToggleCardPositionHandler:e.handleToggleCardPosition})]})},A=e=>{const[a,t]=(0,s.useState)("All"),[n,l]=(0,s.useState)([]),[i,c]=(0,s.useState)([]),[r,o]=(0,s.useState)([]),[d,h]=(0,s.useState)(!1),[u,m]=(0,s.useState)(!1),v=JSON.parse(localStorage.getItem("userJsonData"))?JSON.parse(localStorage.getItem("userJsonData")):[],[g,x]=(0,s.useState)([]),[j,S]=(0,s.useState)(v.filter((e=>"company"===e.role))),[N,C]=(0,s.useState)(v.filter((e=>"Driver"===e.designation))),y=N.filter((e=>"Allocated"===e.activityStatus)),b=N.filter((e=>"Not Allocated"===e.activityStatus));(0,s.useEffect)((()=>{const e=j.reduce(((e,a)=>{const t=v.filter((e=>"Driver"===e.designation&&e.parentCompany===a.userName));return t.length>0&&(e[a.userName]=t),e}),{});x(e)}),[j]),(0,s.useEffect)((()=>{const e=j.reduce(((e,t)=>{const s=v.filter((e=>"Driver"===e.designation&&e.parentCompany===t.userName&&("All"==a||e.activityStatus===a)));return s.length>0&&(e[t.userName]=s),e}),{});x(e)}),[a]);const A=N.length,I=v.filter((e=>"Driver"===e.designation)).map((e=>({id:e.id,name:e.firstName+" "+e.lastName})));return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"px-2 vehicle_tracking-object",children:[(0,f.jsxs)("span",{bg:"",pill:!0,className:`light fs-9  running ${"Allocated"===a?"vehicle_tracking-active":u&&"pe-none"}`,onClick:()=>t("Allocated"),children:[(0,f.jsx)("p",{children:y.length}),(0,f.jsx)("span",{children:"Allocated"})]}),(0,f.jsxs)("span",{bg:"",pill:!0,className:`light fs-9 idle ${"Not Allocated"===a?"vehicle_tracking-active":u&&"pe-none"}`,onClick:()=>t("Not Allocated"),children:[(0,f.jsx)("p",{children:b.length}),(0,f.jsx)("span",{children:"Not Allocated"})]}),(0,f.jsxs)("span",{bg:"",pill:!0,className:`light fs-9 total ${"Total"===a?"vehicle_tracking-active":u&&"pe-none"}`,onClick:()=>t("All"),children:[(0,f.jsx)("p",{children:A}),(0,f.jsx)("span",{children:"Total"})]})]}),(0,f.jsx)("div",{className:"d-flex mt-4 mb-4",children:(0,f.jsx)(p.ReactSearchAutocomplete,{items:I,className:"w-100",styling:{height:"30px",marginRight:"10px",fontSize:"12px",color:"#red"},onSearch:(e,a)=>{if(""===e){const e=j.reduce(((e,a)=>{const t=v.filter((e=>"Driver"===e.designation&&e.parentCompany===a.userName));return t.length>0&&(e[a.userName]=t),e}),{});x(e)}},onSelect:e=>{const a=e.id,t=j.reduce(((e,t)=>{const s=v.filter((e=>"Driver"===e.designation&&e.parentCompany===t.userName&&e.id===a));return s.length>0&&(e[t.userName]=s),e}),{});x(t)}})}),(0,f.jsx)(k,{drivers:g,handleToggleCardPositionHandler:e.handleToggleCardPosition},g)]})},I=e=>{const a=JSON.parse(localStorage.getItem("geofenceData"))?JSON.parse(localStorage.getItem("geofenceData")):[],[t,n]=(0,s.useState)(a),[l,i]=(0,s.useState)([]),[c,r]=(0,s.useState)(""),o=(t.filter((e=>e.company.toLowerCase().includes(c.toLowerCase()))),t.reduce(((e,a)=>(e[a.company]||(e[a.company]=[]),e[a.company].push(a),e)),{})),d=t.map((e=>({id:e.id,name:e.name})));return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"d-flex mt-4 mb-4",children:(0,f.jsx)(p.ReactSearchAutocomplete,{items:d,className:"w-100",styling:{height:"30px",marginRight:"10px",fontSize:"12px",color:"#red"},onSelect:e=>{const t=a.filter((a=>a.id===e.id));n(t)}})}),(0,f.jsx)("div",{className:"d-flex flex-column p-2",style:{marginTop:".5rem",overflowY:"scroll"},children:(0,f.jsx)(N,{geoFences:o,handleToggleCardPositionHandler:e.handleToggleCardPosition})})]})},T=e=>{let{tabData:a,handleToggleCardPosition:t,isOutside:s,setVehicleIds:n,setVehicleStatus:l,vehicleCounts:i}=e;const c={name:"Company1",drivers:[{name:"driver1",timeStamp:"22-02-2024 3:00 PM",status:"running"},{name:"driver2",timeStamp:"22-02-2024 3:00 PM",status:"idle"},{name:"driver3",timeStamp:"22-02-2024 3:00 PM",status:"inactive"},{name:"driver4",timeStamp:"22-02-2024 3:00 PM",status:"running"},{name:"driver5",timeStamp:"22-02-2024 3:00 PM",status:"stopped"},{name:"driver6",timeStamp:"22-02-2024 3:00 PM",status:"stopped"},{name:"driver7",timeStamp:"22-02-2024 3:00 PM"}],allocatedDriver:4,notAllocatedDriver:3,totalDriver:7},r=[b,A,I];return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)("div",{className:"default-tab outer-container "+(s?"toggleBarInside":"toggleBarOutside"),children:[(0,f.jsx)("button",{onClick:t,className:"driver_tracking_button",children:s?(0,f.jsx)(m.m6W,{}):(0,f.jsx)(m.OQo,{})}),(0,f.jsxs)(h.A.Container,{defaultActiveKey:a[0].name.toLowerCase(),children:[(0,f.jsx)(u.A,{as:"ul",className:"nav-tabs tracking_navTabs",children:a.map(((e,a)=>{const t=e.icon;return(0,f.jsx)(u.A.Item,{as:"li",children:(0,f.jsxs)(u.A.Link,{eventKey:e.name.toLowerCase(),children:[(0,f.jsx)(t,{className:"tab-icon"}),e.name]})},a)}))}),(0,f.jsx)(h.A.Content,{className:"p-2 py-4",style:{background:"#f5f5f5",overflow:"scroll",height:"100vh"},children:a.map(((e,a)=>{const s=r[a];return(0,f.jsx)(h.A.Pane,{eventKey:e.name.toLowerCase(),children:(0,f.jsx)(s,{data:c,handleToggleCardPosition:t,setVehicleIds:n,setVehicleStatus:l,vehicleCounts:i})},a)}))})]})]})})};var D=t(19889);const w=()=>{var e;const{t:a}=(0,c.Bd)(),[t,h]=(0,s.useState)(!0),u=[{name:"Object",icon:i.ETQ},{name:"Driver",icon:n.x$1},{name:"Geofence",icon:l.vVi}],[m,p]=(0,s.useState)([]),[v,g]=(0,s.useState)(""),{data:x}=(0,r.I)({queryKey:["tracking",m.join(","),v],queryFn:()=>(0,D.Up)(m.join(","),v),staleTime:12e4,refetchInterval:12e4,refetchOnWindowFocus:"always"});return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(o.A,{mainTitle:a("vehicleTracking"),pageTitle:a("vehicleTracking"),parentTitle:a("tracking")}),(0,f.jsx)("div",{className:"backdrop "+(t?"d-none":"d-block"),onClick:()=>h(!0)}),(0,f.jsx)("div",{className:"p-2",children:(0,f.jsx)(d.A,{data:[{lat:30.7099475,lng:76.6900474},{lat:30.7333,lng:76.7794}],trackingData:null===x||void 0===x?void 0:x.data,centerCoordinate:null===x||void 0===x?void 0:x.centerCoordinate})}),(0,f.jsx)(T,{tabData:u,setVehicleIds:p,vehicleIds:m,setVehicleStatus:g,vehicleCounts:null!==(e=null===x||void 0===x?void 0:x.count)&&void 0!==e?e:{},handleToggleCardPosition:()=>{h(!t)},isOutside:t})]})}}}]);
//# sourceMappingURL=3925.5ceaaca0.chunk.js.map