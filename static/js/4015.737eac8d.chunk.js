"use strict";(self.webpackChunkFLEET=self.webpackChunkFLEET||[]).push([[4015],{24853:(e,i,t)=>{t.d(i,{I7:()=>n,LF:()=>a,Vz:()=>s,Xu:()=>l,ZS:()=>r,ub:()=>o});var d=t(94505);const s=async()=>{const{data:e}=await d.S.get("/modules");return null===e||void 0===e?void 0:e.data},a=async e=>{let i="/feature-template";void 0!==e&&(i+="?page=".concat(e,"&limit=",10));const{data:t}=await d.S.get(i);return{data:t.data.data,totalPage:t.data.totalPage,totalCount:t.data.totalCount}},n=async e=>await d.S.delete("/feature-template/".concat(e)),l=async e=>await d.S.post("/feature-template",e),o=async e=>await d.S.patch("/feature-template",e),r=async e=>{var i;const{data:t}=await d.S.get("/feature-template/".concat(e));return null===t||void 0===t||null===(i=t.data)||void 0===i?void 0:i.data}},25847:(e,i,t)=>{t.d(i,{A:()=>u});var d=t(65043),s=t(42297),a=t(75714),n=t(28261),l=t(94692),o=t(24853),r=t(45350),c=t(42880),m=t(70579);const u=e=>{let{onChange:i,value:t,customStyles:u,isDisabled:h,name:p,placeholder:v,defaultValue:x}=e;const[f,g]=(0,d.useState)(t),{page:y,setPage:b}=(0,l.A)(),{can:j}=(0,r.A)(),{data:w,fetchNextPage:k,hasNextPage:N,isFetching:_,isFetchingNextPage:M}=(0,a.q)({queryKey:["templates"],queryFn:e=>{let{pageParam:i}=e;return b(i),(0,o.LF)(i)},initialPageParam:1,getNextPageParam:(e,i)=>{var t;return null!==(t=e.data)&&void 0!==t&&t.length?y+1:null},enabled:j("groups","view"),staleTime:1/0}),{refetch:C}=(0,n.I)({queryKey:["template",x],queryFn:()=>(0,o.ZS)(x),enabled:!1,staleTime:1/0}),S=(0,d.useMemo)((()=>{let e=[];return null===w||void 0===w||w.pages.forEach((i=>{i.data.forEach((i=>{e.push({value:i._id,label:i.name})}))})),e}),[w]);(0,d.useEffect)((()=>((null===t||void 0===t?void 0:t.value)!=(null===f||void 0===f?void 0:f.value)&&g(t),()=>{})),[t,S]),(0,d.useEffect)((()=>((async()=>{if(x&&!t){const t=S.find((e=>e.value===x));if(t)return g(t),void i(t);try{const{data:e}=await C();if(e){const t={label:e.name,value:e._id};return g(t),void i(t)}}catch(e){console.log(e)}}})(),()=>{})),[x,t]);return(0,m.jsx)(s.Ay,{options:S,value:f,onChange:i,styles:u,name:p,placeholder:v,isDisabled:h||!j("groups","view"),onMenuScrollToBottom:async e=>{e.target.scrollHeight-e.target.scrollTop===e.target.clientHeight&&!_&&N&&!M&&k()},menuShouldScrollIntoView:!1,isLoading:_,components:{LoadingIndicator:c.A}})}},4015:(e,i,t)=>{t.r(i),t.d(i,{default:()=>y});var d=t(65043),s=t(74117),a=t(60184),n=t(40399),l=t(70579);const o=function(e){const{onClick:i,data:t,isActive:d}=e,{title:a,icon:n}=t,{t:o}=(0,s.Bd)();return(0,l.jsx)("div",{onClick:i,className:"card same-card mx-2 bg-white col-xl-2 col-lg-4 cold-md-4 col-sm-6 ".concat(d?"active-tab":""),style:{height:"160px",width:"160px",border:d?"1px solid #4C9AFF":"1px solid #E6E6E6"},children:(0,l.jsx)("div",{className:"card-body d-flex align-items-center",children:(0,l.jsxs)("div",{className:"d-flex flex-column align-items-center w-100 pb-2",children:[n&&(0,l.jsx)("span",{className:"card-text text-primary fs-1 mb-2",children:n}),(0,l.jsx)("h6",{className:"card-text text-primary text-center fs-4",children:o(a.toLowerCase())})]})})})};const r=function(e){const{tabs:i=[]}=e,[t,s]=(0,d.useState)(i[0]);return(0,l.jsxs)("div",{className:"container-fluid",children:[(0,l.jsx)("div",{className:"tabs row w-100",children:i.map(((e,i)=>(0,l.jsx)(o,{data:e,isActive:t===e,onClick:()=>{s(e)}},i)))}),t&&(0,l.jsx)("div",{children:t.component})]})};var c=t(38628),m=t(64196),u=t(73216),h=t(42457),p=t(24853),v=t(25847),x=t(63248);const f=()=>{const{t:e}=(0,s.Bd)(),[i,t]=(0,d.useState)([]),[a,n]=(0,d.useState)([]),[o,r]=(0,d.useState)([]),f=(0,u.Zp)(),{id:y}=(0,u.g)(),b=(0,x.jE)(),[j,w]=(0,d.useState)({name:"",permission:{}}),[k,N]=(0,d.useState)([]),[_,M]=(0,d.useState)(null),C=(e,i,t)=>{let d=[...o];const s=d.find((e=>e._id===t)),a={...s.permission};if(e)a[i]=!0,a.view=!0;else{if("view"===i&&Object.entries(a).find((e=>{let[i,t]=e;return"view"!==i&&t}))||s.subModules.some((e=>Object.entries(e.permission).some((e=>{let[i,t]=e;return t})))))return;a[i]=!1}const n=d.findIndex((e=>e._id===t));d[n].permission=a,r(d)},[S,E]=(0,d.useState)(!1);(0,d.useEffect)((()=>{if(y){const e=i.filter(((e,i)=>e._id===y));w({name:e.name,permission:e.permission})}}),[y]),(0,d.useEffect)((()=>{(async()=>{try{const e=await(0,p.Vz)(),i={add:!1,view:!1,modify:!1,delete:!1},t=[...e].map((e=>{const t=[...e.subModules].map((e=>({...e,permission:i})));return{...e,permission:i,subModules:t}}));r(t)}catch(e){console.error("Error fetching template data:",e)}})()}),[]);const[A,F]=(0,d.useState)(),P=i.map((e=>e.name));return(0,d.useEffect)((()=>{(async()=>{try{const e=await(0,p.LF)();if(y){const i=await(0,p.Vz)(),t=e.data.find((e=>e._id===y));w(t),F(t.name);const d=i.map((e=>{const i=t.permission.find((i=>i.moduleId===(e.id||e._id)));return i&&(e.permission={add:null===i||void 0===i?void 0:i.add,view:null===i||void 0===i?void 0:i.view,modify:null===i||void 0===i?void 0:i.modify,delete:null===i||void 0===i?void 0:i.delete},e.subModules&&e.subModules.length>0&&e.subModules.forEach((e=>{const i=t.permission.find((i=>i.moduleId===(e.id||e._id)));i&&(e.permission={add:i.add,view:i.view,modify:i.modify,delete:i.delete})}))),e}));r(d),n(t.permission.filter((e=>e.delete||e.view||e.modify||e.add)).map((e=>e.moduleId)))}t(e.data),N(e.data.map((e=>({value:e._id,label:e.name}))))}catch(e){console.error("Error fetching template data:",e)}})()}),[y]),(0,l.jsx)("div",{children:(0,l.jsxs)(c.A,{children:[(0,l.jsx)(c.A.Header,{children:(0,l.jsx)(c.A.Title,{children:e("permission")})}),(0,l.jsxs)("div",{className:"d-flex justify-content-between m-2 mt-4 p-3 mb-0 pb-0",children:[(0,l.jsx)("div",{children:(0,l.jsx)("input",{value:j.name,name:"groupname",type:"text",className:"p-2",onChange:e=>(e=>{E(!1);const{value:i}=e.target;w((e=>({...e,name:i})))})(e),style:{marginRight:"1rem",border:"#D3D3D3 1px solid",borderRadius:"0.3rem",width:"15rem"},placeholder:e("featureTemplateName")})}),(0,l.jsxs)("div",{className:"d-flex justify-content-center",style:{width:"25rem"},children:[(0,l.jsx)(v.A,{placeholder:e("selectFeatureTemplate"),customStyles:{control:e=>({...e,width:"18rem"})},value:{value:null===_||void 0===_?void 0:_._id,label:null===_||void 0===_?void 0:_.name},onChange:e=>{const t=i.find((i=>i._id===e.value));M(t)}}),(0,l.jsx)("button",{className:"btn btn-primary",style:{marginLeft:"1rem",padding:"7px 16px",marginRight:"1rem"},onClick:()=>{if(!_)return;const e=o.map((e=>{var i;const t=_.permission.find((i=>i.moduleId===e._id));return t&&(e.permission={add:null===t||void 0===t?void 0:t.add,view:null===t||void 0===t?void 0:t.view,modify:null===t||void 0===t?void 0:t.modify,delete:null===t||void 0===t?void 0:t.delete}),e.subModules=(null===(i=e.subModules)||void 0===i?void 0:i.map((e=>{const i=_.permission.find((i=>i.moduleId===e.id));return i&&(e.permission={add:null===i||void 0===i?void 0:i.add,view:null===i||void 0===i?void 0:i.view,modify:null===i||void 0===i?void 0:i.modify,delete:null===i||void 0===i?void 0:i.delete}),e})))||[],e}));r(e),n(_.permission.filter((e=>e.delete||e.view||e.modify||e.add)).map((e=>e.moduleId)))},children:e("copy")})]})]}),(0,l.jsx)("div",{className:"ms-4 pt-0 mt-0",children:S&&(0,l.jsx)("span",{className:"text-danger text-sm pt-0 mt-0",style:{marginBottom:"1rem"},children:"feature template name is required"})}),(0,l.jsxs)(c.A.Body,{className:"d-flex",children:[(0,l.jsx)("div",{style:{flex:.4,maxHeight:"50vh",overflow:"auto",border:"1px solid #D3D3D3  ",borderRadius:"0.5rem"},children:(0,l.jsxs)(m.A,{children:[(0,l.jsx)("thead",{style:{position:"sticky",top:0,background:"white"},children:(0,l.jsx)("tr",{children:(0,l.jsx)("th",{scope:"col",children:e("module")})})}),(0,l.jsx)("tbody",{children:o.map(((i,t)=>i&&i.title?(0,l.jsx)(d.Fragment,{children:(0,l.jsx)("tr",{children:"Reports"!==i.title&&(0,l.jsxs)("td",{children:[(0,l.jsx)("input",{type:"checkbox",className:"form-check-input",style:{marginRight:"0.2rem"},name:"create",checked:a.includes(i._id)||i.subModules.some((e=>a.includes(e.id))),onChange:e=>((e,i)=>{e?n((e=>[...e,i])):(n((e=>e.filter((e=>e!==i)))),r((e=>e.map((e=>e._id===i?{...e,subModules:e.subModules.map((e=>({...e,permission:{add:!1,view:!1,modify:!1,delete:!1}}))),permission:{add:!1,view:!1,modify:!1,delete:!1}}:e)))))})(e.target.checked,i._id)}),(0,l.jsx)("span",{style:{marginRight:"1.7rem"},children:e(i.title)})]})})},i._id):null))})]})}),(0,l.jsx)("div",{style:{flex:1,maxHeight:"50vh",overflow:"auto",border:"1px solid #D3D3D3",borderRadius:"0.5rem",marginLeft:"0.2rem"},children:(0,l.jsxs)(m.A,{children:[(0,l.jsx)("thead",{id:"feature_template",style:{position:"sticky",top:0,background:"white"},children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{scope:"col",className:"col-4",style:{width:"150px"},children:e("subModules")}),(0,l.jsx)("th",{scope:"col",children:e("add")}),(0,l.jsx)("th",{scope:"col",children:e("view")}),(0,l.jsx)("th",{scope:"col",children:e("modify")}),(0,l.jsx)("th",{scope:"col",children:e("delete")})]})}),(0,l.jsx)(g,{subModuleIndexArray:a,data:o,handleModulePermisssionChange:C,handleSubModulePermisssionChange:(e,i,t,d)=>{const s=o.map((s=>{if(e&&C(e,"view",t),s._id===t){const t=s.subModules.map((t=>{if(t.id===d){const d={...t.permission};return!e&&"view"===i&&Object.entries(d).find((e=>{let[i,t]=e;return"view"!==i&&t}))?t:(e&&(d.view=!0),d[i]=e,{...t,permission:d})}return t}));return{...s,subModules:t}}return s}));r(s)}})]})})]}),(0,l.jsx)("div",{className:"d-flex justify-content-end  p-3",children:(0,l.jsx)("button",{className:"btn btn-primary",style:{marginLeft:"1rem",padding:"7px 16px"},onClick:async()=>{if(j.name){if(y){if(P.includes(j.name)&&j.name!==A)return void(0,h.U)("Feature Template name already exists")}else if(P.includes(j.name))return void(0,h.U)("Feature Template name already exists");try{E(!1);const e=o.reduce(((e,i)=>{var t,d,s,a;const n={moduleId:i._id,add:null===(t=i.permission)||void 0===t?void 0:t.add,view:null===(d=i.permission)||void 0===d?void 0:d.view,modify:null===(s=i.permission)||void 0===s?void 0:s.modify,delete:null===(a=i.permission)||void 0===a?void 0:a.delete};return e.push(n),i.subModules&&i.subModules.length>0&&i.subModules.forEach((i=>{var t,d,s,a;const n={moduleId:i.id,add:null===(t=i.permission)||void 0===t?void 0:t.add,view:null===(d=i.permission)||void 0===d?void 0:d.view,modify:null===(s=i.permission)||void 0===s?void 0:s.modify,delete:null===(a=i.permission)||void 0===a?void 0:a.delete};e.push(n)})),e}),[]),i={...j,permission:e};w((i=>({...i,permission:e})));const t=y?p.ub:p.Xu;await t(i),b.invalidateQueries(["groups"]),n([]),(0,h.V)("saved"),f("/groups")}catch(e){console.error("Error saving data:",e)}}else E(!0)},children:e(y?"update":"save")})})]})})},g=e=>{let{subModuleIndexArray:i,data:t,handleSubModulePermisssionChange:s,handleModulePermisssionChange:a}=e;const n=new Set;return(0,l.jsx)("tbody",{className:"feature_template_table",children:i.length>0&&i.map(((e,i)=>{var o,r,c,m;const u=t.find((i=>i._id===e||i.subModules.some((i=>i.id===e))));if(!u||n.has(u._id))return null;n.add(u._id);let h=!1;return"Dashboard"===u.title&&(h=!0),(0,l.jsxs)(d.Fragment,{children:[(0,l.jsxs)("tr",{children:[(0,l.jsxs)("td",{className:"col-2",style:{width:"130px"},children:[" ",u.title]}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(o=u.permission)||void 0===o?void 0:o.add,onChange:e=>a(e.target.checked,e.target.name,u._id),className:"form-check-input",name:"add",disabled:h||u.subModules.length>0})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(r=u.permission)||void 0===r?void 0:r.view,className:"form-check-input",onChange:e=>a(e.target.checked,e.target.name,u._id),name:"view"})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(c=u.permission)||void 0===c?void 0:c.modify,className:"form-check-input",onChange:e=>a(e.target.checked,e.target.name,u._id),disabled:h||u.subModules.length>0,name:"modify"})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(m=u.permission)||void 0===m?void 0:m.delete,className:"form-check-input",onChange:e=>a(e.target.checked,e.target.name,u._id),disabled:h||u.subModules.length>0,name:"delete"})})]}),u.subModules.map(((e,i)=>{var t,d,a,n;return(0,l.jsxs)("tr",{children:[(0,l.jsxs)("td",{className:"col-2",children:[" ",e.title]}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(t=e.permission)||void 0===t?void 0:t.add,onChange:i=>s(i.target.checked,i.target.name,u._id,e.id),className:"form-check-input",name:"add"})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(d=e.permission)||void 0===d?void 0:d.view,onChange:i=>s(i.target.checked,i.target.name,u._id,e.id),className:"form-check-input",name:"view"})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(a=e.permission)||void 0===a?void 0:a.modify,onChange:i=>s(i.target.checked,i.target.name,u._id,e.id),className:"form-check-input",name:"modify"})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(n=e.permission)||void 0===n?void 0:n.delete,onChange:i=>s(i.target.checked,i.target.name,u._id,e.id),className:"form-check-input",name:"delete"})})]},i)}))]},e)}))})},y=()=>{const{t:e}=(0,s.Bd)(),i=[{title:"Permission",component:(0,l.jsx)(f,{}),icon:(0,l.jsx)(a.x$1,{})}];return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.A,{mainTitle:e("permission"),pageTitle:e("permission"),parentTitle:e("featureTemplates")}),(0,l.jsx)(r,{tabs:i})]})}}}]);
//# sourceMappingURL=4015.737eac8d.chunk.js.map