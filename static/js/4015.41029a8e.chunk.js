"use strict";(self.webpackChunkFLEET=self.webpackChunkFLEET||[]).push([[4015],{24853:(e,t,i)=>{i.d(t,{I7:()=>n,LF:()=>a,Vz:()=>d,Xu:()=>l,ZS:()=>r,ub:()=>o});var s=i(94505);const d=async()=>{const{data:e}=await s.S.get("/modules");return null===e||void 0===e?void 0:e.data},a=async e=>{let t="/feature-template";void 0!==e&&(t+="?page=".concat(e,"&limit=",10));const{data:i}=await s.S.get(t);return{data:i.data.data,totalPage:i.data.totalPage,totalCount:i.data.totalCount}},n=async e=>await s.S.delete("/feature-template/".concat(e)),l=async e=>await s.S.post("/feature-template",e),o=async e=>await s.S.patch("/feature-template",e),r=async e=>{var t;const{data:i}=await s.S.get("/feature-template/".concat(e));return null===i||void 0===i||null===(t=i.data)||void 0===t?void 0:t.data}},25847:(e,t,i)=>{i.d(t,{A:()=>u});var s=i(65043),d=i(42297),a=i(75714),n=i(28261),l=i(94692),o=i(24853),r=i(45350),c=i(42880),m=i(70579);const u=e=>{let{onChange:t,value:i,customStyles:u,isDisabled:h,name:p,placeholder:v,defaultValue:x}=e;const[f,g]=(0,s.useState)(i),{page:y,setPage:b}=(0,l.A)(),{can:j}=(0,r.A)(),{data:w,fetchNextPage:k,hasNextPage:N,isFetching:_,isFetchingNextPage:M}=(0,a.q)({queryKey:["templates"],queryFn:e=>{let{pageParam:t}=e;return b(t),(0,o.LF)(t)},initialPageParam:1,getNextPageParam:(e,t)=>{var i;return null!==(i=e.data)&&void 0!==i&&i.length?y+1:null},enabled:j("groups","view"),staleTime:1/0}),{refetch:C}=(0,n.I)({queryKey:["template",x],queryFn:()=>(0,o.ZS)(x),enabled:!1,staleTime:1/0}),S=(0,s.useMemo)((()=>{let e=[];return null===w||void 0===w||w.pages.forEach((t=>{t.data.forEach((t=>{e.push({value:t._id,label:t.name})}))})),e}),[w]);(0,s.useEffect)((()=>((null===i||void 0===i?void 0:i.value)!=(null===f||void 0===f?void 0:f.value)&&g(i),()=>{})),[i,S]),(0,s.useEffect)((()=>((async()=>{if(x&&!i){const i=S.find((e=>e.value===x));if(i)return g(i),void t(i);try{const{data:e}=await C();if(console.log({template:e}),e){const i={label:e.name,value:e._id};return g(i),void t(i)}}catch(e){console.log(e)}}})(),()=>{})),[x,i]);return(0,m.jsx)(d.Ay,{options:S,value:f,onChange:t,styles:u,name:p,placeholder:v,isDisabled:h||!j("groups","view"),onMenuScrollToBottom:async e=>{e.target.scrollHeight-e.target.scrollTop===e.target.clientHeight&&!_&&N&&!M&&k()},menuShouldScrollIntoView:!1,isLoading:_,components:{LoadingIndicator:c.A}})}},4015:(e,t,i)=>{i.r(t),i.d(t,{default:()=>y});var s=i(65043),d=i(74117),a=i(60184),n=i(40399),l=i(70579);const o=function(e){const{onClick:t,data:i,isActive:s}=e,{title:d,icon:a}=i;return(0,l.jsx)("div",{onClick:t,className:"card same-card mx-2 bg-white col-xl-2 col-lg-4 cold-md-4 col-sm-6 ".concat(s?"active-tab":""),style:{height:"160px",width:"160px",border:s?"1px solid #4C9AFF":"1px solid #E6E6E6"},children:(0,l.jsx)("div",{className:"card-body d-flex align-items-center",children:(0,l.jsxs)("div",{className:"d-flex flex-column align-items-center w-100 pb-2",children:[a&&(0,l.jsx)("span",{className:"card-text text-primary fs-1 mb-2",children:a}),(0,l.jsx)("h6",{className:"card-text text-primary text-center fs-4",children:d})]})})})};const r=function(e){const{tabs:t=[]}=e,[i,d]=(0,s.useState)(t[0]);return(0,l.jsxs)("div",{className:"container-fluid",children:[(0,l.jsx)("div",{className:"tabs row w-100",children:t.map(((e,t)=>(0,l.jsx)(o,{data:e,isActive:i===e,onClick:()=>{d(e)}},t)))}),i&&(0,l.jsx)("div",{children:i.component})]})};var c=i(38628),m=i(64196),u=i(73216),h=i(42457),p=i(24853),v=i(25847),x=i(63248);const f=()=>{const{t:e}=(0,d.Bd)(),[t,i]=(0,s.useState)([]),[a,n]=(0,s.useState)([]),[o,r]=(0,s.useState)([]),f=(0,u.Zp)(),{id:y}=(0,u.g)(),b=(0,x.jE)(),[j,w]=(0,s.useState)({name:"",permission:{}}),[k,N]=(0,s.useState)([]),[_,M]=(0,s.useState)(null),C=(e,t,i)=>{let s=[...o];const d=s.find((e=>e._id===i)),a={...d.permission};if(e)a[t]=!0,a.view=!0;else{if("view"===t&&Object.entries(a).find((e=>{let[t,i]=e;return"view"!==t&&i}))||d.subModules.some((e=>Object.entries(e.permission).some((e=>{let[t,i]=e;return i})))))return;a[t]=!1}const n=s.findIndex((e=>e._id===i));s[n].permission=a,r(s)},[S,E]=(0,s.useState)(!1);(0,s.useEffect)((()=>{if(y){const e=t.filter(((e,t)=>e._id===y));w({name:e.name,permission:e.permission})}}),[y]),(0,s.useEffect)((()=>{(async()=>{try{const e=await(0,p.Vz)(),t={add:!1,view:!1,modify:!1,delete:!1},i=[...e].map((e=>{const i=[...e.subModules].map((e=>({...e,permission:t})));return{...e,permission:t,subModules:i}}));r(i)}catch(e){console.error("Error fetching template data:",e)}})()}),[]);const[A,F]=(0,s.useState)(),P=t.map((e=>e.name));return(0,s.useEffect)((()=>{(async()=>{try{const e=await(0,p.LF)();if(y){const t=await(0,p.Vz)(),i=e.data.find((e=>e._id===y));w(i),F(i.name);const s=t.map((e=>{const t=i.permission.find((t=>t.moduleId===(e.id||e._id)));return t&&(e.permission={add:null===t||void 0===t?void 0:t.add,view:null===t||void 0===t?void 0:t.view,modify:null===t||void 0===t?void 0:t.modify,delete:null===t||void 0===t?void 0:t.delete},e.subModules&&e.subModules.length>0&&e.subModules.forEach((e=>{const t=i.permission.find((t=>t.moduleId===(e.id||e._id)));t&&(e.permission={add:t.add,view:t.view,modify:t.modify,delete:t.delete})}))),e}));r(s),n(i.permission.filter((e=>e.delete||e.view||e.modify||e.add)).map((e=>e.moduleId)))}i(e.data),N(e.data.map((e=>({value:e._id,label:e.name}))))}catch(e){console.error("Error fetching template data:",e)}})()}),[y]),(0,l.jsx)("div",{children:(0,l.jsxs)(c.A,{children:[(0,l.jsx)(c.A.Header,{children:(0,l.jsx)(c.A.Title,{children:e("permission")})}),(0,l.jsxs)("div",{className:"d-flex justify-content-between m-2 mt-4 p-3 mb-0 pb-0",children:[(0,l.jsx)("div",{children:(0,l.jsx)("input",{value:j.name,name:"groupname",type:"text",className:"p-2",onChange:e=>(e=>{E(!1);const{value:t}=e.target;w((e=>({...e,name:t})))})(e),style:{marginRight:"1rem",border:"#D3D3D3 1px solid",borderRadius:"0.3rem",width:"15rem"},placeholder:e("featureTemplateName")})}),(0,l.jsxs)("div",{className:"d-flex justify-content-center",style:{width:"25rem"},children:[(0,l.jsx)(v.A,{placeholder:e("selectFeatureTemplate"),customStyles:{control:e=>({...e,width:"18rem"})},value:_,onChange:e=>{const i=t.find((t=>t._id===e.value));M(i)}}),(0,l.jsx)("button",{className:"btn btn-primary",style:{marginLeft:"1rem",padding:"7px 16px",marginRight:"1rem"},onClick:()=>{if(!_)return;const e=o.map((e=>{var t;const i=_.permission.find((t=>t.moduleId===e._id));return i&&(e.permission={add:null===i||void 0===i?void 0:i.add,view:null===i||void 0===i?void 0:i.view,modify:null===i||void 0===i?void 0:i.modify,delete:null===i||void 0===i?void 0:i.delete}),e.subModules=(null===(t=e.subModules)||void 0===t?void 0:t.map((e=>{const t=_.permission.find((t=>t.moduleId===e.id));return t&&(e.permission={add:null===t||void 0===t?void 0:t.add,view:null===t||void 0===t?void 0:t.view,modify:null===t||void 0===t?void 0:t.modify,delete:null===t||void 0===t?void 0:t.delete}),e})))||[],e}));r(e),n(_.permission.filter((e=>e.delete||e.view||e.modify||e.add)).map((e=>e.moduleId)))},children:e("copy")})]})]}),(0,l.jsx)("div",{className:"ms-4 pt-0 mt-0",children:S&&(0,l.jsx)("span",{className:"text-danger text-sm pt-0 mt-0",style:{marginBottom:"1rem"},children:"feature template name is required"})}),(0,l.jsxs)(c.A.Body,{className:"d-flex",children:[(0,l.jsx)("div",{style:{flex:.4,maxHeight:"50vh",overflow:"auto",border:"1px solid #D3D3D3  ",borderRadius:"0.5rem"},children:(0,l.jsxs)(m.A,{children:[(0,l.jsx)("thead",{style:{position:"sticky",top:0,background:"white"},children:(0,l.jsx)("tr",{children:(0,l.jsx)("th",{scope:"col",children:e("module")})})}),(0,l.jsx)("tbody",{children:o.map(((t,i)=>t&&t.title?(0,l.jsx)(s.Fragment,{children:(0,l.jsx)("tr",{children:(0,l.jsxs)("td",{children:[(0,l.jsx)("input",{type:"checkbox",className:"form-check-input",style:{marginRight:"0.2rem"},name:"create",checked:a.includes(t._id)||t.subModules.some((e=>a.includes(e.id))),onChange:e=>((e,t)=>{e?n((e=>[...e,t])):(n((e=>e.filter((e=>e!==t)))),r((e=>e.map((e=>e._id===t?{...e,subModules:e.subModules.map((e=>({...e,permission:{add:!1,view:!1,modify:!1,delete:!1}}))),permission:{add:!1,view:!1,modify:!1,delete:!1}}:e)))))})(e.target.checked,t._id)}),(0,l.jsx)("span",{style:{marginRight:"1.7rem"},children:e(t.title)})]})})},t._id):null))})]})}),(0,l.jsx)("div",{style:{flex:1,maxHeight:"50vh",overflow:"auto",border:"1px solid #D3D3D3",borderRadius:"0.5rem",marginLeft:"0.2rem"},children:(0,l.jsxs)(m.A,{children:[(0,l.jsx)("thead",{id:"feature_template",style:{position:"sticky",top:0,background:"white"},children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{scope:"col",className:"col-4",style:{width:"150px"},children:e("subModules")}),(0,l.jsx)("th",{scope:"col",children:e("add")}),(0,l.jsx)("th",{scope:"col",children:e("view")}),(0,l.jsx)("th",{scope:"col",children:e("modify")}),(0,l.jsx)("th",{scope:"col",children:e("delete")})]})}),(0,l.jsx)(g,{subModuleIndexArray:a,data:o,handleModulePermisssionChange:C,handleSubModulePermisssionChange:(e,t,i,s)=>{const d=o.map((d=>{if(e&&C(e,"view",i),d._id===i){const i=d.subModules.map((i=>{if(i.id===s){const s={...i.permission};return!e&&"view"===t&&Object.entries(s).find((e=>{let[t,i]=e;return"view"!==t&&i}))?i:(e&&(s.view=!0),s[t]=e,{...i,permission:s})}return i}));return{...d,subModules:i}}return d}));r(d)}})]})})]}),(0,l.jsx)("div",{className:"d-flex justify-content-end  p-3",children:(0,l.jsxs)("button",{className:"btn btn-primary",style:{marginLeft:"1rem",padding:"7px 16px"},onClick:async()=>{if(j.name){if(y){if(P.includes(j.name)&&j.name!==A)return void(0,h.U)("Feature Template name already exists")}else if(P.includes(j.name))return void(0,h.U)("Feature Template name already exists");try{E(!1);const e=o.reduce(((e,t)=>{var i,s,d,a;const n={moduleId:t._id,add:null===(i=t.permission)||void 0===i?void 0:i.add,view:null===(s=t.permission)||void 0===s?void 0:s.view,modify:null===(d=t.permission)||void 0===d?void 0:d.modify,delete:null===(a=t.permission)||void 0===a?void 0:a.delete};return e.push(n),t.subModules&&t.subModules.length>0&&t.subModules.forEach((t=>{var i,s,d,a;const n={moduleId:t.id,add:null===(i=t.permission)||void 0===i?void 0:i.add,view:null===(s=t.permission)||void 0===s?void 0:s.view,modify:null===(d=t.permission)||void 0===d?void 0:d.modify,delete:null===(a=t.permission)||void 0===a?void 0:a.delete};e.push(n)})),e}),[]),t={...j,permission:e};w((t=>({...t,permission:e})));const i=y?p.ub:p.Xu;await i(t),b.invalidateQueries(["groups"]),n([]),(0,h.V)("saved"),f("/groups")}catch(e){console.error("Error saving data:",e)}}else E(!0)},children:[" ",y?"Update":"Save"," "]})})]})})},g=e=>{let{subModuleIndexArray:t,data:i,handleSubModulePermisssionChange:d,handleModulePermisssionChange:a}=e;const n=new Set;return(0,l.jsx)("tbody",{className:"feature_template_table",children:t.length>0&&t.map(((e,t)=>{var o,r,c,m;const u=i.find((t=>t._id===e||t.subModules.some((t=>t.id===e))));if(!u||n.has(u._id))return null;n.add(u._id);let h=!1;return"Dashboard"===u.title&&(h=!0),(0,l.jsxs)(s.Fragment,{children:[(0,l.jsxs)("tr",{children:[(0,l.jsxs)("td",{className:"col-2",style:{width:"130px"},children:[" ",u.title]}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(o=u.permission)||void 0===o?void 0:o.add,onChange:e=>a(e.target.checked,e.target.name,u._id),className:"form-check-input",name:"add",disabled:h||u.subModules.length>0})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(r=u.permission)||void 0===r?void 0:r.view,className:"form-check-input",onChange:e=>a(e.target.checked,e.target.name,u._id),name:"view"})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(c=u.permission)||void 0===c?void 0:c.modify,className:"form-check-input",onChange:e=>a(e.target.checked,e.target.name,u._id),disabled:h||u.subModules.length>0,name:"modify"})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(m=u.permission)||void 0===m?void 0:m.delete,className:"form-check-input",onChange:e=>a(e.target.checked,e.target.name,u._id),disabled:h||u.subModules.length>0,name:"delete"})})]}),u.subModules.map(((e,t)=>{var i,s,a,n;return(0,l.jsxs)("tr",{children:[(0,l.jsxs)("td",{className:"col-2",children:[" ",e.title]}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(i=e.permission)||void 0===i?void 0:i.add,onChange:t=>d(t.target.checked,t.target.name,u._id,e.id),className:"form-check-input",name:"add"})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(s=e.permission)||void 0===s?void 0:s.view,onChange:t=>d(t.target.checked,t.target.name,u._id,e.id),className:"form-check-input",name:"view"})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(a=e.permission)||void 0===a?void 0:a.modify,onChange:t=>d(t.target.checked,t.target.name,u._id,e.id),className:"form-check-input",name:"modify"})}),(0,l.jsx)("td",{children:(0,l.jsx)("input",{type:"checkbox",checked:null===(n=e.permission)||void 0===n?void 0:n.delete,onChange:t=>d(t.target.checked,t.target.name,u._id,e.id),className:"form-check-input",name:"delete"})})]},t)}))]},e)}))})},y=()=>{const{t:e}=(0,d.Bd)(),t=[{title:"Permission",component:(0,l.jsx)(f,{}),icon:(0,l.jsx)(a.x$1,{})}];return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.A,{mainTitle:e("permission"),pageTitle:e("permission"),parentTitle:e("Feature Templates")}),(0,l.jsx)(r,{tabs:t})]})}}}]);
//# sourceMappingURL=4015.41029a8e.chunk.js.map